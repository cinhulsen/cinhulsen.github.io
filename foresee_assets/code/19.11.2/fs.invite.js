/***************************************
 * @preserve
 * Copyright (c) 2019 Verint Systems, Inc. All rights reserved.
 * ForeSee Web SDK: Invitation Presenter
 * Version: 19.11.2
 * Built: November 07, 2019, 12:47:06 CST
 ***************************************/
_fsDefine(["fs",_fsNormalizeUrl("$fs.utils.js"),"exports"],function(e,t,n){var s;return function(){function n(n,i,a,l,o,c){var r=this;this.cfg=n,this.def=e.ext({},i),this.display=l,this.template=this.display.template,this.brwsr=a,this._inviteEls=[],this.locale=o.get("locale")||"en",this.lastActiveEl=null,this.lastScroll=null,s=c,this.isCustom=s.customInvitationRequested.subscriptions.length>0,this.inviteStage=0,this.declined=new t.FSEvent,this.declined.subscribe(function(){r._removeEls()}),this.abandoned=new t.FSEvent,this.abandoned.subscribe(function(){r._removeEls()}),this.accepted=new t.FSEvent,this.completed=new t.FSEvent,this.completed.subscribe(function(e){e&&r._removeEls()})}var i=n.prototype;return i.loadResources=function(n){var s=this,i=this.display;if(this.isCustom)n.fire();else{var a=i.template,l=e.makeURI("$templates/trigger/"+a+"/"+(i.dialog.theme?i.dialog.theme:"main")+".css"),o=e.makeURI("$templates/trigger/"+a+"/invite.html"),c=!1,r=!1,d=function(){c&&r&&n&&n.fire()};0===a.indexOf("@")&&(a=a.substr(1),l=e.makeAssetURI("trigger/templates/"+a+"/"+(i.dialog.theme?i.dialog.theme:"main")+".css"),o=e.makeAssetURI("trigger/templates/"+a+"/invite.html")),t.loadCSS(l,function(){c=!0,d()},null,this.brwsr),new t.TemplateFetcher({success:function(e){r=!0,s.invitetemplate=e,d()}}).get(o)}},i._validateMobileInput=function(n){var s=document.getElementById("acsEmailSMSInput"),i=s.value,a=document.getElementById("acsInvalidInput"),l=function(e){return/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i.test(e)},o=function(e){var t=e.replace(/[ -.()]+/g,"").match(/^(\+44|44|0044|0)([1-9]\d{8,9})$/);return t?"+44"+t[2]:null},c=function(e){return(e=e.split(" ").join("")).match(/^(\+1|1)?[-.]?\(?([0-9]{3})\)?[-.]?([0-9]{3})[-.]?([0-9]{4})$/)&&e.length<=15||!!o(e)},r=function(){s.setAttribute("aria-invalid","true"),a.setAttribute("role","alert"),t.removeClass(a,"acsNoDisplay"),s.focus()},d=function(){t.addClass(a,"acsNoDisplay"),s.removeAttribute("aria-invalid"),setTimeout(function(){n(o(i)||i)},250)};switch(n=n||function(){},this.display.inviteType){case"SMS":c(i)?d():r();break;case"EMAIL":l(i)?d():r();break;case"SMSEMAIL":"mobile"!==e.toLowerCase(this.template)?l(i)||c(i)?d():r():t.hasClass(s,"acsSMSValue")?c(i)?d():r():l(i)?d():r();break;case"SHORTSURVEY":break;default:throw new Error("Unknown inviteType: "+this.display.inviteType)}},i._switchToMobileOnExitStageInvite=function(){var e=document,n=e.querySelector("#acsMainInvite"),s=e.querySelector("#acsOnExitMobileInvite"),i=e.querySelector("#acsFullScreenContainer");i&&(t.addClass(e.body,"acsFullScreen"),t.addClass(e.documentElement,"acsFullScreen"),t.addClass(i,"acsFullScreen"),t.addClass(s,"acsClassicInvite--fullscreen")),t.addClass(n,"acsNoDisplay"),t.removeClass(s,"acsNoDisplay"),i&&e.querySelector("#acsEmailSMSInput").focus(),this.inviteStage+=1},i._switchToThankYouPage=function(){var e,n=this,s=document,i=s.getElementById("acsOnExitMobileInvite"),a=s.getElementById("acsOnExitThankYou"),l=s.getElementById("acsFullScreenContainer"),o=s.getElementsByClassName("acsDeclineButton"),c=1e3*Number(this.display.dialog.onexitcounterval)||8e3,r=function(e){t.preventDefault(e),n.completed.fire(!0)};if(l){for(var d=0;d<o.length;d++)t.Unbind(o[d],"invite:click"),t.Bind(o[d],"invite:click",r),t.removeClass(o[d],"acsDeclineButton");t.removeClass(l,"__acs__input-clicked"),t.addClass(i,"acsNoDisplay"),t.removeClass(a,"acsNoDisplay"),a.focus(),this.closeTimeOut=setTimeout(function(){n.completed.fire(!0)},c+1e3),this.counterInterval=setInterval(function(){var n=document.getElementsByClassName("counter");l&&n&&(e=Number(n[0].innerHTML),n[0].innerHTML=e-1,1===Number(e)&&t.addClass(l,"__acs--complete"))},1e3)}this.inviteStage+=1},i._handleAcceptCurrentStage=function(){var e=this,t=document.getElementById("acsFullScreenContainer")||document.getElementById("fsrFullScreenContainer");switch(this.display.inviteType){case"TRACKER":case"INSESSION":this.accepted.fire(this.display.inviteType),this.completed.fire(!0);break;case"SMS":case"EMAIL":case"SMSEMAIL":0===this.inviteStage?(this._switchToMobileOnExitStageInvite(),this._trapKeyBoardMobile(t)):1===this.inviteStage&&this._validateMobileInput(function(n){e.accepted.fire(e.display.inviteType,n),t&&(e._switchToThankYouPage(),e._trapKeyBoardMobile(t))});break;case"SHORTSURVEY":break;default:throw new Error("Unknown inviteType: "+this.display.inviteType)}},i._removeEls=function(){for(clearTimeout(this.closeTimeOut),clearInterval(this.counterInterval),t.removeClass(document.body,"acsFullScreen"),t.removeClass(document.documentElement,"acsFullScreen");this._inviteEls.length>0;){var e=this._inviteEls.pop();e.parentNode.removeChild(e)}this.restoreUserFocus(),this.restoreUserScroll(),t.Unbind("invite:*")},i._trapKeyBoard=function(e,n){t.Bind(document.body,"invite:focus",function(s){var i=(s=s||window.event).target||s.srcElement;t.DOMContains(e,i)||(s.stopPropagation(),n.focus())},!1)},i._trapKeyBoardMobile=function(e,n,s){var i,a,l=this;0===this.inviteStage?i=function(s){return!!((a=e.getAttribute("data-trapkeyboard"))&&"false"!=a||l.display.trapFocus)&&(!t.DOMContains(n,s)||!e)}:1===this.inviteStage?(t.Unbind(document.body,"invite:focus"),n=document.getElementById("acsFullScreenContainer")||document.getElementById("fsrFullScreenContainer"),s=document.getElementById("acsContactClose")||document.getElementById("fsrContactClose"),i=function(s){return!t.DOMContains(n,s)||!e}):2===this.inviteStage&&(t.Unbind(document.body,"invite:focus"),s=document.getElementById("acsOnExitThankYou"),i=function(n){return!t.DOMContains(s,n)||!e}),t.Bind(document.body,"invite:focus",function(e){var t=e.target||e.srcElement;i(t)&&s&&(e.stopPropagation(),s.focus())},!1)},i.present=function(){var n=this;if(this.lastActiveEl||(this.lastActiveEl=document.activeElement,this.lastScroll=t.getScroll(window)),this.isCustom)return this.inviteStage=1,s.customInvitationRequested.fire(this.display.inviteType,function(e){n.accepted.fire(n.display.inviteType,e),n.completed.fire(!0)},function(){n.declined.fire()},function(){n.abandoned.fire()}),void(s._triggerResetLock=!1);this.display.inviteType=this.display.inviteType.toUpperCase();var i=e.ext({supportsSVG:this.brwsr.supportsSVG},this.display,this.cfg.config);i.inviteLogo&&i.inviteLogo.length&&(i.inviteLogo=e.makeAssetURI("trigger/"+i.inviteLogo)),i.inviteBanner&&i.inviteBanner.length&&(i.inviteBanner=e.makeAssetURI("trigger/"+i.inviteBanner)),i.trackerLogo&&i.trackerLogo.length&&(i.trackerLogo=e.makeAssetURI("trigger/"+i.trackerLogo)),i.vendorLogo&&i.vendorLogo.length&&(i.vendorLogo=e.makeURI("$"+i.vendorLogo)),i.vendorLogoPNG&&i.vendorLogoPNG.length&&(i.vendorLogoPNG=e.makeURI("$"+i.vendorLogoPNG)),i.trusteLogo&&i.trusteLogo.length&&(i.trusteLogo=e.makeURI("$"+i.trusteLogo)),i.style=e.ext({invite:{},tracker:{},presetStyles:""},i.style),i.style.invite.backgroundImage&&(i.style.invite.backgroundImage=e.makeURI("$"+i.style.invite.backgroundImage)),i.style.tracker.backgroundImage&&(i.style.tracker.backgroundImage=e.makeURI("$"+i.style.tracker.backgroundImage));var a=this.invitetemplate(i),l=document.createElement("div");l.innerHTML=a;for(var o=0;o<l.childNodes.length;o++)this._inviteEls.push(l.childNodes[o]),document.body.appendChild(l.childNodes[o]);var c=document.getElementById("acsEmailSMSInput"),r=document.getElementById("acsMainInvite")||document.getElementById("fsrInvite"),d=document.getElementById("acsFullScreenContainer")||document.getElementById("fsrFullScreenContainer"),u=document.getElementById("acsFocusFirst")||document.getElementById("fsrFocusFirst");u.focus(),this.brwsr.isMobile?this._trapKeyBoardMobile(d,r,u):this._trapKeyBoard(r,u);for(var m=document.querySelectorAll(".acsDeclineButton, .fsrDeclineButton"),v=function(e){t.preventDefault(e),n.declined.fire("INVITE_DECLINED_BTN")},h=0;h<m.length;h++)t.Bind(m[h],"invite:click",v);for(var g=document.querySelectorAll(".acsAcceptButton, .fsrAcceptButton"),p=document.getElementsByClassName("acsSubmitBtn"),f=document.getElementsByClassName("acsClassicInvite--fullscreen__container"),y=document.getElementsByClassName("acsClassicInner--description"),C=document.getElementsByClassName("acsClassingInner--policyLink"),I=function(e){t.preventDefault(e);var s=e.target||e.srcElement;if(t.hasClass(s,"acsEmailInput")||t.hasClass(s.parentNode,"acsEmailInput")){var i=document.getElementsByClassName("acsClassicInvite--placeholder")[0];i&&(i.innerHTML=n.display.dialog.emailPlaceholder||""),c.type="email",t.hasClass(c,"acsClassicInvite__input--spaced")&&t.removeClass(c,"acsClassicInvite__input--spaced"),t.hasClass(c,"acsSMSValue")&&(t.removeClass(c,"acsSMSValue"),t.addClass(c,"acsEmailValue")),document.getElementById("acsInvalidInput").innerHTML=n.display.dialog.emailInvalidation||"",n.display.dialog.emailDisclaimer?y[0].innerHTML=n.display.dialog.emailDisclaimer:y[0]&&t.addClass(y[0],"acsNoDisplay"),t.addClass(C[0],"acsNoDisplay"),t.removeClass(C[1],"acsNoDisplay")}t.hasClass(s,"acsClassicInner--btn__grey")||n._handleAcceptCurrentStage()},E=0;E<g.length;E++)t.Bind(g[E],"invite:click",I);d&&(t.Bind(c,"invite:focus",function(e){var n=e.target||e.srcElement;if(d){t.addClass(f[0],"acsClassicInvite--fullscreen__input-clicked");var s=function(e){var n;if(e){if(t.hasClass(e,"acsClassicInvite--placeholder"))return e;for(var s=e.parentNode.childNodes,i=0;i<s.length;i++)if(t.hasClass(s[i],"acsClassicInvite--placeholder")){n=s[i];break}if(!n)for(var a=e.childNodes,l=0;l<a.length;l++)if(t.hasClass(a[l],"acsClassicInvite--placeholder")){n=a[l];break}}return n}(n);s&&t.addClass(s,"acsClassicInvite--placeholder__clicked"),t.addClass(d,"__acs__input-clicked")}}),t.Bind(c,"invite:input",t.debounce(function(e){var n=(e.target||e.srcElement).value.replace(/\s/g,""),s=t.getKeyCode(e);"escape"!==s&&t.toggleClass(p[0],"acsClassicInner--btn__grey",n.length<1),n.length>0&&"enter"===s&&I({target:p})},100))),this.__kpEscape=function(e){"escape"==t.getKeyCode(e)&&(t.preventDefault(e),n.declined.fire("INVITE_DECLINED_ESC"))},t.Bind(document.body,"invite:keydown",this.__kpEscape);for(var S=function(e){for(var s=e.target||e.srcElement,a=!1;s;){if(s.tagName&&"A"==s.tagName&&(t.hasClass(s,"acsAllowDefault")||t.hasClass(s,"fsrAllowDefault"))){a=!0;break}s=s.parentNode}a||t.preventDefault(e);var l=e.target||e.srcElement;!t.hasClass(l,"acsAbandonButton")&&!t.hasClass(l,"fsrAbandonButton")||"true"==l.getAttribute("data-isbackdrop")&&!i.closeClickOnBackdrop||n.abandoned.fire()},b=document.querySelectorAll(".acsAbandonButton, .fsrAbandonButton"),k=0;k<b.length;k++)t.Bind(b[k],"invite:click",S);s._triggerResetLock=!1},i.dispose=function(){this.disposed||(this.disposed=!0,this._removeEls())},i.restoreUserFocus=function(){null!==this.lastActiveEl?this.lastActiveEl.focus():document.body.focus()},i.restoreUserScroll=function(){this.lastScroll&&window.scroll(this.lastScroll.x,this.lastScroll.y)},n}()});
