/***************************************
 * @preserve
 * Copyright (c) 2019 Verint Systems, Inc. All rights reserved.
 * ForeSee Web SDK: Record Worker
 * Version: 19.11.2
 * Built: November 07, 2019, 12:47:06 CST
 ***************************************/
!function(){var e,t=function(){function e(){this.elIndex=new Map,this.idIndex=new Map,this.idEl=new Map,this.root=null,this.nextId=1}var t=e.prototype;return t.scan=function(e){var t,i,s=[],n={id:0,p:0,t:e.nodeType,c:s};for(null==this.root&&(this.root=n),t=0,i=e.childNodes.length;t<i;t++)this.get(e.childNodes[t])||s.push(this.scan(e.childNodes[t]));if(this._track(e,n),null!=e.nodeValue&&(n.v=e.nodeValue),"#"!==e.nodeName[0]){if(n.n=e.nodeName,e.hasAttributes&&e.hasAttributes()){for(n.a={},t=0,i=e.attributes.length;t<i;t++){var a=e.attributes[t].name;n.a[a]=e.attributes[t].value,"href"!==a&&"src"!==a||!e[a]||"A"===e.nodeName||"AREA"===e.nodeName||"SCRIPT"===e.nodeName||(n.a[a]=e[a])}["INPUT","SELECT","TEXTAREA"].indexOf(e.nodeName.toUpperCase())>-1&&(n.a.value=e.value)}10===e.nodeType&&(n.publicId&&(n.publicId=e.publicId),n.systemId&&(n.systemId=e.systemId))}for(t=0,i=s.length;t<i;t++)s[t].p=n.id;return n},t.import=function(e){var t,i;for(null==this.root&&(this.root=e),t=0,i=e.c.length;t<i;t++)this.import(e.c[t]);return this.idIndex.set(e.id,e),e},t.add=function(e,t){var i=this.get(e),s=Array.prototype.indexOf.call(e.childNodes,t),n=this.scan(t);return i.c.splice(s,0,n),n.p=i.id,n},t.insert=function(e,t){var i=this.getById(t.p);return this.import(t),i.c.splice(e,0,t),t},t.move=function(e,t,i,s){var n,a=this.get(e),r=this.getById(a.p),d=this.get(t);r.c.splice(r.c.indexOf(a),1),a.p=d.id,i?s?d.c.splice(d.c.indexOf(this.get(s)),0,a):((n=d.c.indexOf(this.get(i))+1)>d.c.length&&(n=d.c.length),n<0&&(n=0),d.c.splice(n,0,a)):s&&this.get(s)===d.c[0]?d.c.unshift(a):((n=d.c.indexOf(this.get(s)))>d.c.length&&(n=d.c.length),n<0&&(n=0),d.c.splice(n,0,a))},t.moveById=function(e,t,i){var s=this.getById(e),n=this.getById(s.p),a=this.getById(t);n.c.splice(n.c.indexOf(s),1),a.c.splice(i,0,s),s.p=a.id},t.get=function(e){return this.elIndex.get(e)},t.getById=function(e){return this.idIndex.get(e)},t.remove=function(e){var t,i,s=this.get(e);for(t=s.c.length-1;t>=0;t--)this.remove(this.idEl.get(s.c[t].id));return this.elIndex.delete(e),this.idIndex.delete(s.id),this.idEl.delete(s.id),s.p>0&&(i=this.getById(s.p)).c.splice(i.c.indexOf(s),1),s},t.removeById=function(e){var t,i=this.getById(e);if(i){var s=this.getById(i.p);for(t=i.c.length-1;t>=0;t--)this.removeById(i.c[t].id);return this.idIndex.delete(e),s&&s.c.splice(s.c.indexOf(i),1),i}},t._track=function(e,t){var i=this.nextId;return this.nextId++,t.id=i,this.elIndex.set(e,t),this.idIndex.set(i,t),this.idEl.set(i,e),i},t.dispose=function(){this.elIndex.clear(),this.idIndex.clear(),this.idEl.clear(),this.nextId=1,this.root=null},e}(),i=6,s=8,n=12,a=17,r=30,d=31,o=34,h=37,c=42,l={alphabetL:"abcdefghijklmnopqrstuvwxyz",alphabetU:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",numbers:"0123456789"},u="value label placeholder title".split(" "),g=function(){function e(e,t){var i=this;this.tree=e,this.pii=t||{noRules:!0},this.targets={unmasked:new Set,masked:new Set,whitelist:new Set,redact:new Set},this.originalValues=new Map,this.originalAttrs={},u.forEach(function(e){i.originalAttrs[e]=new Map}),this.maskingChanged=new Set}var t=e.prototype;return t.censor=function(e){var t=this;this._isNodeMasked(e)?this._maskNode(e):this._unmaskNode(e),this.targets.redact.has(e.id)&&(e.redact=!0),e.c&&e.c.length>0&&e.c.forEach(function(e){t.censor(e)})},t.clean=function(e){var t=this;if("SCRIPT"==(e.n||"").toUpperCase()&&(this._removeAttr(e,"src"),this._blankTreeText(e)),e.a)for(var i in e.a)i.length>2&&"on"==i.substr(0,2)&&delete e.a[i];e.c&&e.c.length>0&&e.c.forEach(function(e){t.clean(e)})},t.updateMaskingTargets=function(e){var t=this,i=this.targets;for(var s in this.targets={},e)this.targets[s]=new Set(e[s]);var n=function(e){t.targets[e].forEach(function(s){i[e].has(s)||t.maskingChanged.add(s)}),i[e].forEach(function(i){t.targets[e].has(i)||t.maskingChanged.add(i)})};for(var a in e)n(a)},t.added=function(e){if(this.maskingChanged.has(e.id)&&this.maskingChanged.delete(e.id),e.c)for(var t=0;t<e.c.length;t++)this.added(e.c[t])},t.determineNodesToResend=function(){var e=this,t=[];return this.maskingChanged.forEach(function(i){var s=e.tree.getById(i);s&&(e._hasParentInList(s,e.maskingChanged)||(e.censor(s),t.push(s)))}),this.maskingChanged.clear(),t},t.updateOriginalValue=function(e,t){var i=this.originalAttrs.value.get(e.id);i&&(i.orig=t)},t.removeOriginalValue=function(e){var t=this;this.originalValues.has(e)&&this.originalValues.delete(e),u.forEach(function(i){t.originalAttrs[i].has(e)&&t.originalAttrs[i].delete(e)});var i=this.tree.getById(e);i&&i.c&&i.c.length>0&&i.c.forEach(function(e){t.removeOriginalValue(e.id)})},t.isInputMasked=function(e){return!this._branchInList(e,this.targets.whitelist)&&(!e.a||"true"!==e.a.fsrVisible)},t.maskString=function(e){var t=this;return e.replace(/[^.,!?@#$%()\\\/:\s-]/g,function(e){return t.pii.maskCharacters?t.pii.maskCharacters.substr(Math.round(Math.random()*(t.pii.maskCharacters.length-1)),1):l.numbers.indexOf(e)>-1?l.numbers.substr(Math.round(Math.random()*(l.numbers.length-1)),1):e==e.toUpperCase()?l.alphabetU.substr(Math.round(Math.random()*(l.alphabetU.length-1)),1):l.alphabetL.substr(Math.round(Math.random()*(l.alphabetL.length-1)),1)})},t._isNodeAnInput=function(e){for(;e.p>0;){var t=(e.n||"").toUpperCase();if("INPUT"===t||"TEXTAREA"===t||"SELECT"===t)return!0;e=this.tree.getById(e.p)}return!1},t._isStyleTag=function(e){return!!e.p&&"STYLE"===(this.tree.getById(e.p).n||"").toUpperCase()},t._isNodeMasked=function(e){if(this._isStyleTag(e))return!1;if(this._isNodeAnInput(e))return this.isInputMasked(e);if(this.pii.useWhiteListing){if(this.pii.noRules)return!0;if(!this._branchInList(e,this.targets.unmasked))return!0}else if(!this.pii.noRules&&this._branchInList(e,this.targets.masked))return!0;return!1},t._removeAttr=function(e,t){e.a&&delete e.a[t]},t._maskNode=function(e){var t=this;e.v&&(e.v=this._scramble(e.id,e.v,this.originalValues)),u.forEach(function(i){e.a&&e.a[i]&&(e.a[i]=t._scramble(e.id,e.a[i],t.originalAttrs[i]))})},t._scramble=function(e,t,i){var s=i.get(e)||{orig:"",masked:""};return i.has(e)||i.set(e,s),s.orig===t?s.masked:s.masked===t?s.masked:(s.orig=t,s.masked=this.maskString(t),s.masked)},t._unmaskNode=function(e){var t=this;this.originalValues.has(e.id)&&(e.v=this.originalValues.get(e.id).orig,this.originalValues.delete(e.id)),u.forEach(function(i){t.originalAttrs[i].has(e.id)&&(e.a[i]=t.originalAttrs[i].get(e.id).orig,t.originalAttrs[i].delete(e.id))})},t._blankTreeText=function(e){var t=this;void 0!==e.v&&null!=e.v&&(e.v=""),e.c&&e.c.length>0&&e.c.forEach(function(e){t._blankTreeText(e)})},t._branchInList=function(e,t){return t.has(e.id)||this._hasParentInList(e,t)},t._hasParentInList=function(e,t){for(;e.p>0;){if(t.has(e.p))return!0;e=this.tree.getById(e.p)}return!1},e}();self._fsDefine=function(t,i){var s={};i(s),e=s.compress};var f=51200,p=function(){function t(e,t,i,s){this.tree=e,this.censorFactory=function(){return new g(e,t)},this.censor=new Map,this.censorFrames=new Set,this.log=[],this.payloadReady=i,this.partial=s,this.dataSizeGoal=2*f,this.firstPacket=!0,this.corked=!0,this.dataSize=0}var l=t.prototype;return l.checkChecksum=function(e,t,i){},l.uncork=function(){this.corked=!1,this.firstPacket&&0===this.log.length&&(this.uncorkedRecently=!0),this.pinch()},l.wrapup=function(){this.corked||this.pinch()},l.addEvents=function(e){var t,l=this,u=this.tree;e.forEach(function(e){if(e.d){var g=l.getCensorForFrame(e.d.ctx);if(e.e===c)g.updateMaskingTargets(e.d.targets);else if(e.e==a&&e.d.doc){t=u.import(e.d.doc),e.d.maskingTargets&&(g.updateMaskingTargets(e.d.maskingTargets),delete e.d.maskingTargets),g.clean(t),g.censor(t),g.added(t);l.addCensorChangedNodes([]),e.d.doc=JSON.parse(JSON.stringify(t))}else if(e.e==h)e.d.forEach(function(e){var i=l.getCensorForFrame(e.d.ctx);switch(e.e){case n:(t=u.getById(e.d.id)).a=t.a||{},t.a[e.d.attr]=e.d.val,i.clean(t),"value"===e.d.attr&&i.updateOriginalValue(e.d.id,e.d.val),e.d.val=t.a[e.d.attr];break;case o:(t=u.getById(e.d.id)).v=e.d.v,i.censor(t),i.added(t),e.d.v=t.v;break;case d:i.removeOriginalValue(e.d.id),u.removeById(e.d.id);break;case r:u.insert(e.d.idx,e.d.tree),i.clean(e.d.tree),i.censor(e.d.tree),i.added(e.d.tree),e.d.tree=JSON.parse(JSON.stringify(e.d.tree));break;default:throw new Error("Unsupported DOM mutation type "+e.e)}}),l.addCensorChangedNodes(e.d);else if(e.e===s){var f=function(e,t){if("string"!=typeof e||0===e.length)return{s:0,v:t,e:0};if("string"!=typeof t||0===t.length)return{s:0,v:"",e:0};if(e===t)return null;var i,s={},n=Math.min(e.length,t.length);for(i=0;i<n;i++){if(e.charCodeAt(i)!==t.charCodeAt(i)){s.s=i;break}i===n-1&&(s.s=n)}n=e.length;var a=t.length,r=Math.min(n-s.s,a-s.s);for(i=0;i<r;i++)if(e.charCodeAt(n-i-1)!==t.charCodeAt(a-i-1))return s.e=i,s.v=t.substr(s.s,a-i-s.s),s;return s.e=0,s.v=t.substr(s.s,a-s.s),s}(e.d.v0,e.d.v1);t=u.getById(e.d.id),f&&(g.isInputMasked(t)&&(g.updateOriginalValue(e.d.id,e.d.v1),f.v=g.maskString(f.v)),e.d.s=f.s,e.d.e=f.e,e.d.v=f.v),delete e.d.v0,delete e.d.v1}else e.e===i&&e.d.v&&(t=u.getById(e.d.id),g.isInputMasked(t)&&(g.updateOriginalValue(e.d.id,e.d.v),e.d.v=g.maskString(e.d.v)))}}),e=e.filter(function(e){return e.e!==c}),this.partial(e),this.log=this.log.concat(e),this.dataSize+=JSON.stringify(e).length,(this.dataSize>=1048576||!this.corked&&this.dataSize>=this.dataSizeGoal||this.uncorkedRecently)&&(this.uncorkedRecently=!1,this.pinch())},l.getCensorForFrame=function(e){return null==e?null:(this.censor.has(e)||this.censor.set(e,this.censorFactory()),this.censorFrames.add(e),this.censor.get(e))},l.addCensorChangedNodes=function(e){var t=this;this.censorFrames.forEach(function(i){t.censor.get(i).determineNodesToResend().forEach(function(s){var n=s.p>0&&t.tree.getById(s.p)?t.tree.getById(s.p).c.indexOf(s):0;e.push({e:d,d:{ctx:i,id:s.id}}),e.push({e:r,d:{ctx:i,tree:JSON.parse(JSON.stringify(s)),idx:n}})})}),this.censorFrames.clear()},l.pinch=function(){if(this.log.length>0){var t=e(JSON.stringify(this.log));if(!this.firstPacket){var i=t.length/this.dataSize;this.dataSizeGoal=Math.floor(f/i)}this.firstPacket=!1,this.payloadReady(t),this.log=[],this.dataSize=0}},t}(),v=self,m=function(e,t){postMessage({messageType:e,data:t||("PAYLOAD"===e?"":{})})},k=function(e){m("PAYLOAD",e)},I=function(e){m("PARTIAL",e)};v.onmessage=function(e){if(e.data&&e.data.messageType)switch(e.data.messageType){case"INIT":var i=new t;v.importScripts(e.data.data.compressUrl),v.logger=new p(i,e.data.data.pii,k,I);break;case"DISPOSE":break;case"EVENTS":v.logger.addEvents(e.data.data);break;case"WRAPUP":v.logger.wrapup();break;case"UNCORK":v.logger.uncork()}}}();
