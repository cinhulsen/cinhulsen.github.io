/***************************************
 * @preserve
 * Copyright (c) 2019 Verint Systems, Inc. All rights reserved.
 * ForeSee Web SDK: Session Record
 * Version: 19.11.2
 * Built: November 07, 2019, 12:47:06 CST
 ***************************************/
_fsDefine(["fs",_fsNormalizeUrl("$fs.utils.js"),_fsNormalizeUrl("$fs.compress.js"),"exports"],function(e,t,i,s){var r={},n=window,o="fs_sessionStarted",a="fs_recorderCanceled",c="fs_recorderStoppedOldBrowser",l="fs_recorderTransmitFailed",u={SESSIONID:"rpid",GLOBALSESSIONID:"mid",TRANSMITTING:"rt",CANCELED:"cncl",CANCELEDPERMANENT:"rcp",SESSION:"SESSION",DATA:"DATA",GLOBALREFRESHTIME:"grft",DONOTRECORD:"norec",PAGENUM:"rpn"},d=function(){function i(e,t,i){this.config=e,this.browser=t,this.didSkipOnPurpose=!1,this.reasons={},this.cpps=i}return i.prototype.supported=function(){var i,s,r,o=this,a=this.config.advancedSettings||{},c=this.browser,l=this.config.blacklist,u=this.config.whitelist,d=!1,h=a.device_type_support,f=location.toString();if(a.browser_cutoff||(a.browser_cutoff={}),a.platform_cutoff||(a.platform_cutoff={}),a.useSessionStorage){if(!t.SeshStorage.isSupported())return this.reasons.sessionStorageUnsupported=!0,!1;this.reasons.sessionStorageUnsupported=!1}a.browser_cutoff.IE=Math.max(a.browser_cutoff.IE,11),a.browser_cutoff.Safari=Math.max(a.browser_cutoff.Safari,8),a.browser_cutoff.Chrome=Math.max(a.browser_cutoff.Chrome,38),a.browser_cutoff["Chrome Mobile"]=Math.max(a.browser_cutoff["Chrome Mobile"],38),a.platform_cutoff.Android=Math.max(a.platform_cutoff.Android,5),["iPod","iPhone","iPad"].forEach(function(e){a.platform_cutoff[e]=Math.max(a.platform_cutoff[e],8)});var p=function(i,a,c){var l=c[a];switch(a){case"urls":case"text":for(s=0;s<l.length;s++){if(t.testAgainstSearch(l[s],f))return o.reasons[i+"_"+a+"_"+s]=!0,!0;o.reasons[i+"_"+a+"_"+s]=!1}break;case"variables":for(s=0;s<l.length;s++)if(e.isDefined(l[s].name)){if(r=t.retrieveNestedVariable(n,l[s].name),l[s].value===r)return o.reasons[i+"_"+a+"_"+l[s].name]=!0,!0;if(!0===r&&"true"==l[s].value)return o.reasons[i+"_"+a+"_"+l[s].name]=!0,!0;if(!1===r&&"false"==l[s].value)return o.reasons[i+"_"+a+"_"+l[s].name]=!0,!0;o.reasons[i+"_"+a+"_"+l[s].name]=!1}break;case"cookies":var u,d=new t.Cookie;for(s=0;s<l.length;s++){if(u=d.get(l[s].name),e.isDefined(u)&&u==l[s].value)return o.reasons[i+"_"+a+"_"+l[s].name]=!0,!0;o.reasons[i+"_"+a+"_"+l[s].name]=!1}break;case"cpps":var h=o.cpps.all();for(s=0;s<l.length;s++){var p=l[s],g=p.name,m=p.value;if(g&&void 0!==typeof m){var v=h[g];if(void 0!==typeof v&&v===m)return o.reasons[i+"_"+a+"_"+g]=!0,!0}}break;default:throw new Error("unknown criteria type "+a)}return o.reasons[i+"_"+a]=!1,!1};if(a.browser_cutoff[c.browser.name]&&c.browser.actualVersion<a.browser_cutoff[c.browser.name])return this.reasons.browserUnsupported=!0,!1;if(this.reasons.browserUnsupported=!1,a.platform_cutoff[c.os.name]&&c.os.version<a.platform_cutoff[c.os.name])return this.reasons.platformUnsupported=!0,!1;if(this.reasons.platformUnsupported=!1,h&&(!h.desktop&&!c.isMobile||!h.tablet&&c.isTablet||!h.phone&&c.isMobile&&!c.isTablet))return this.reasons.deviceTypeUnsupported=!0,!1;if(this.reasons.deviceTypeUnsupported=!1,l)for(i in l)if(p("blacklist",i,l))return this.didSkipOnPurpose=!0,this.reasons.blacklistMatched=!0,!1;if(this.reasons.blacklistMatched=!1,u){for(i in u)if(p("whitelist",i,u)){d=!0;break}if(!d)return this.didSkipOnPurpose=!0,this.reasons.whitelistNotMatched=!0,!1}for(this.reasons.whitelistNotMatched=!1,i=0;i<a.device_blacklist.length;i++)if(e.toLowerCase(c.agent).indexOf(a.device_blacklist[i].toLowerCase())>-1)return this.reasons.deviceBlacklisted=!0,!1;return this.reasons.deviceBlacklisted=!1,!0},i}(),h={DOM_SERIALIZE:0,FRAME_SIZE:2,FRAME_SCROLL:3,MOUSE_MOVE:4,WINDOW_MOUSEOUT_MOUSEENTER:5,INPUT_SERIALIZE:6,FOCUS_BLUR:7,KEY_PRESS:8,CARET_INFO:9,ATTR_MODIFIED:12,JAVASCRIPT_ERROR:13,MOUSE_CLICK:14,MOUSE_DOWN:15,MOUSE_UP:16,PAGE_MARKER:17,DOC_SIZE:18,SCROLL_EL:19,NOT_RECORDED:20,CSS_SERIALIZE:21,ORIENTATION:22,ZOOM:23,TOUCH:24,ORIENTATION_CHANGE:26,CUSTOM_BEHAVIOR:27,CUSTOM_ERROR:28,HEARTBEAT:29,NODE_ADDED:30,NODE_REMOVED:31,PAGE_VISIBLE:32,INPUT_RESIZE:33,CHAR_DATA:34,MOD_LIST:37,NODE_MOVED:38,PAGE_ERROR:40,ASSET_ERROR:41,MASKING_CHANGE:42},f={};f._apiReady=new t.FSEvent,e.API.expose("beginTransmitting",function(){f._apiReady.subscribe(function(){f._controller.beginTransmitting()},!0,!0)}),e.API.expose("cancelRecord",function(){f._apiReady.subscribe(function(){f._controller.cancelRecord()},!0,!0)}),e.API.expose("getSession",function(e){e=e||console.table||console.log,f._apiReady.subscribe(function(){var t=f._controller.getGlobalId(),i=f._controller.getSessionId();e({gsessionid:t,sessionid:i,sig:t+"/"+i})},!0,!0)}),e.API.expose("Record",{getConfig:function(t){(t=t||console.log)(JSON.parse(JSON.stringify(e.getProductConfig("record"))))},process:function(){f._apiReady.subscribe(function(){f._controller.recorder&&(f._controller.recorder.flush(),setTimeout(function(){f._controller.recorder.processImmediately(0)},1e3))},!0,!0)},flush:function(){f._apiReady.subscribe(function(){f._controller.recorder&&f._controller.recorder.flush()},!0,!0)},dashboard:function(){f._apiReady.subscribe(function(){var t=f._controller.getGlobalId(),i=f._controller.getSessionId(),s="prod";/qa-/.test(e.globalConfig.recUrl)?s="qa":/dev-/.test(e.globalConfig.recUrl)&&(s="dev"),window.open("https://replay-dashboard.foresee.com/"+s+"/"+t+"/"+i,"_blank")},!0,!0)},getPIIConfig:function(e){e=e||console.table||console.log,f._apiReady.subscribe(function(){if(f._controller.recorder)return e(JSON.parse(JSON.stringify(f._controller.recorder.getPIIConfig())))},!0,!0)},getPIIElements:function(e){e=e||console.log,f._apiReady.subscribe(function(){if(f._controller.recorder){var t=f._controller.recorder.getMaskingTargets()||{};return e({selectiveUnMaskZones:t.unmasked,selectiveMaskZones:t.masked,visibleInputs:t.whitelist,redactZones:t.redact})}},!0,!0)},diagnoseCriteria:function(e){e=e||console.table||console.log,f._apiReady.subscribe(function(){if(f._controller.crit)return e(f._controller.crit.reasons)},!0,!0)},error:function(e,t){f._apiReady.subscribe(function(){f._controller.sendCustomEvent(h.CUSTOM_ERROR,"ERROR",e,t)},!0,!0)},event:function(e,t){f._apiReady.subscribe(function(){f._controller.sendCustomEvent(h.CUSTOM_BEHAVIOR,"EVENT",e,t)},!0,!0)}}),f.ready=function(e){f._controller=e,f._apiReady.fire()};var p={getParentWindow:function(e){var t=e;if(e){if(e._pw)return e._pw;if(e.ownerDocument&&e.ownerDocument.defaultView)return e.ownerDocument.defaultView;for(;e.parentNode||e.document;){if(e.document)return t._pw=e,e;e=e.parentNode}}},getDocType:function(t,i){var s,r="",n=i.doctype,o=i.childNodes,a=0;if(t.isIE&&("CSS1Compat"!=i.compatMode||5==i.documentMode))return r;if(n){try{if((s=(new XMLSerializer).serializeToString(n).toString())&&s.length>0)return s}catch(c){}r="<!DOCTYPE HTML",n.publicId&&(r+=' PUBLIC "'+n.publicId+'"'),n.systemId&&(r+=' SYSTEM "'+n.systemId+'"'),r+=">"}else if(o[a].text){for(;o[a].text&&(0===o[a].text.indexOf("\x3c!--")||0===o[a].text.indexOf("<?xml"));)a++;e.isDefined(o[a].text)&&0===e.toLowerCase(o[a].text).indexOf("<!doctype")&&(r=o[a].text)}return r},getStyle:function(e,t,i){if(!t)return"";var s="",r=t.document.defaultView;return r&&r.getComputedStyle&&r.getComputedStyle(e,"")?s=r.getComputedStyle(e,"").getPropertyValue(i):e.currentStyle&&(i=i.replace(/-(\w)/g,function(e,t){return t.toUpperCase()}),s=e.currentStyle[i]),s},getPosition:function(e,t){for(var i=0,s=0,r=p.getStyle;e;)i+=e.offsetTop+(parseFloat(r(e,t,"borderTopWidth"))||0),s+=e.offsetLeft+(parseFloat(r(e,t,"borderLeftWidth"))||0),e=e.offsetParent;return{x:s,y:i}},getPositionRelativeToMainView:function(e,i,s){for(var r,n=!1;!n&&i;){n=i.parent==i;var o=p.getPosition(e,i),a=t.getScroll(i);s&&!n&&(o.x-=a.x,o.y-=a.y),r?(r.x+=o.x,r.y+=o.y):r=o,e=i.frameElement,i=i.parent}return r},getDocSize:function(e){var t=e||window.document,i=t.body,s=t.documentElement,r=Math.max;return{width:r(r(i.scrollWidth,s.scrollWidth),r(i.offsetWidth,s.offsetWidth),r(i.clientWidth,s.clientWidth)),height:r(r(i.scrollHeight,s.scrollHeight),r(i.offsetHeight,s.offsetHeight),r(i.clientHeight,s.clientHeight))}},getVisualViewportPosition:function(e){return e.visualViewport?{left:e.visualViewport.pageLeft,top:e.visualViewport.pageTop,width:e.visualViewport.width,height:e.visualViewport.height}:{left:e.pageXOffset,top:e.pageYOffset,width:e.innerWidth,height:e.innerHeight}},getViewportSizePos:function(e){var t=p.getVisualViewportPosition(e),i=p.getDocSize(e.document),s=e.document.documentElement,r=s.clientWidth,n=s.clientHeight;function o(e){return Math.round(1e3*e)/1e3}return{pw:o(i.width),ph:o(i.height),lw:o(r),lh:o(n),vw:o(t.width),vh:o(t.height),vx:o(t.left),vy:o(t.top)}},externalizeStyleCSSTextToInnerHTML:function(t){var i,s,r=e.getProductConfig("record"),n=!1;if(e.isDefined(r.useCSSText)||((i=document.createElement("style")).setAttribute("type","text/css"),r.useCSSText=e.isDefined(i.styleSheet)),r.useCSSText)for(var o=0,a=(i="STYLE"==t.nodeName?[t]:t.querySelectorAll("style")).length;o<a;o++)(s=i[o]).styleSheet&&s.styleSheet.cssText&&s.styleSheet.cssText.replace(/\s/gi,"").length!=s.innerHTML.replace(/\s/gi,"").length&&(s.innerHTML=s.styleSheet.cssText,n=!0);return n}},g=function(){function e(){this.elIndex=new Map,this.idIndex=new Map,this.idEl=new Map,this.root=null,this.nextId=1}var t=e.prototype;return t.scan=function(e){var t,i,s=[],r={id:0,p:0,t:e.nodeType,c:s};for(null==this.root&&(this.root=r),t=0,i=e.childNodes.length;t<i;t++)this.get(e.childNodes[t])||s.push(this.scan(e.childNodes[t]));if(this._track(e,r),null!=e.nodeValue&&(r.v=e.nodeValue),"#"!==e.nodeName[0]){if(r.n=e.nodeName,e.hasAttributes&&e.hasAttributes()){for(r.a={},t=0,i=e.attributes.length;t<i;t++){var n=e.attributes[t].name;r.a[n]=e.attributes[t].value,"href"!==n&&"src"!==n||!e[n]||"A"===e.nodeName||"AREA"===e.nodeName||"SCRIPT"===e.nodeName||(r.a[n]=e[n])}["INPUT","SELECT","TEXTAREA"].indexOf(e.nodeName.toUpperCase())>-1&&(r.a.value=e.value)}10===e.nodeType&&(r.publicId&&(r.publicId=e.publicId),r.systemId&&(r.systemId=e.systemId))}for(t=0,i=s.length;t<i;t++)s[t].p=r.id;return r},t.import=function(e){var t,i;for(null==this.root&&(this.root=e),t=0,i=e.c.length;t<i;t++)this.import(e.c[t]);return this.idIndex.set(e.id,e),e},t.add=function(e,t){var i=this.get(e),s=Array.prototype.indexOf.call(e.childNodes,t),r=this.scan(t);return i.c.splice(s,0,r),r.p=i.id,r},t.insert=function(e,t){var i=this.getById(t.p);return this.import(t),i.c.splice(e,0,t),t},t.move=function(e,t,i,s){var r,n=this.get(e),o=this.getById(n.p),a=this.get(t);o.c.splice(o.c.indexOf(n),1),n.p=a.id,i?s?a.c.splice(a.c.indexOf(this.get(s)),0,n):((r=a.c.indexOf(this.get(i))+1)>a.c.length&&(r=a.c.length),r<0&&(r=0),a.c.splice(r,0,n)):s&&this.get(s)===a.c[0]?a.c.unshift(n):((r=a.c.indexOf(this.get(s)))>a.c.length&&(r=a.c.length),r<0&&(r=0),a.c.splice(r,0,n))},t.moveById=function(e,t,i){var s=this.getById(e),r=this.getById(s.p),n=this.getById(t);r.c.splice(r.c.indexOf(s),1),n.c.splice(i,0,s),s.p=n.id},t.get=function(e){return this.elIndex.get(e)},t.getById=function(e){return this.idIndex.get(e)},t.remove=function(e){var t,i,s=this.get(e);for(t=s.c.length-1;t>=0;t--)this.remove(this.idEl.get(s.c[t].id));return this.elIndex.delete(e),this.idIndex.delete(s.id),this.idEl.delete(s.id),s.p>0&&(i=this.getById(s.p)).c.splice(i.c.indexOf(s),1),s},t.removeById=function(e){var t,i=this.getById(e);if(i){var s=this.getById(i.p);for(t=i.c.length-1;t>=0;t--)this.removeById(i.c[t].id);return this.idIndex.delete(e),s&&s.c.splice(s.c.indexOf(i),1),i}},t._track=function(e,t){var i=this.nextId;return this.nextId++,t.id=i,this.elIndex.set(e,t),this.idIndex.set(i,t),this.idEl.set(i,e),i},t.dispose=function(){this.elIndex.clear(),this.idIndex.clear(),this.idEl.clear(),this.nextId=1,this.root=null},e}(),m=function(){function i(i,s,r,n){var o=this;e.ext(this,{throttleTime:r,recFunction:n,subject:i,lastCap:t.now()},!1),t.Bind(i,s,function(e){o._capture&&o._capture(e,i)})}var s=i.prototype;return s.merge=function(e,i,s){var r=this;return t.Bind(e,i,function(t){r._capture&&r._capture(t,e,s)}),this},s._capture=function(i,s,r){clearTimeout(this.lastCapThrottle),this._eventCopy=e.ext({},i,!1),t.now()-this.lastCap>this.throttleTime?(this.recFunction(i,s,r),this.lastCap=t.now()):(this.capCB=function(i,s){return e.isDefined(i.clientX)&&(i.sX=i.clientX,i.sY=i.clientY),function(){this.capCB=null,i.delayed=!0,this.recFunction(i,s,r),this.lastCap=t.now()}}(this._eventCopy,s).bind(this),this.lastCapThrottle=setTimeout(this.capCB,this.throttleTime-(t.now()-this.lastCap)))},s.trigger=function(){this.capCB&&(clearTimeout(this.lastCapThrottle),this.capCB())},s.dispose=function(){clearTimeout(this.lastCapThrottle),e.dispose(this)},i}(),v=100,_=function(){function i(t,i,s,r){e.ext(this,{rec:s,masker:t,worker:i,tree:r,_inputs:new Map,_scanValueInterval:setInterval(this._scanInputValues.bind(this),v)},!1)}var s=i.prototype;return s.scanForInputs=function(e){for(var t=this,i=function(e){return!t._inputs.has(e)},s=0;s<e.length;s++){var r=e[s].querySelectorAll("input, textarea, select");Array.prototype.filter.call(r,i).forEach(this._watchInput.bind(this))}},s._updateKnownValue=function(e,t){var i=this._inputs.get(e);return i.oldVal!==t&&(i.oldVal=t,!0)},s._getPreviousValue=function(e){var t=this._inputs.get(e);return t&&t.oldVal||""},s._watchInput=function(e){var i=this,s=(e.getAttribute("type")||"").toUpperCase(),r=e.tagName.toUpperCase();this._inputs.set(e,{}),this._serializeInput(e,!0),"TEXTAREA"==r||"INPUT"==r&&"EMAIL,PASSWORD,TEXT,COLOR,DATE,DATETIME-LOCAL,MONTH,NUMBER,RANGE,SEARCH,TEL,TIME,URL,WEEK".indexOf(s)>-1?(this.rec.bind(e,"focus",function(e){var t=e.target||e.srcElement;i._inputs.has(t)&&(i._queueFocusEvent(t,!0),i._serializeInput(t),i._logCaretInfo(t,!0))}),this.rec.bind(e,"blur",function(e){var t=e.target||e.srcElement;i._inputs.has(t)&&(i._queueFocusEvent(t,!1),i._serializeInput(t))}),this.rec.bind(e,"select",function(e){var t=e.target||e.srcElement;i._logCaretInfo(t)}),this.rec.bind(e,"input",function(e){var t=e.target||e.srcElement;if(i._inputs.has(t)){var s=t.value||"",r=i._getPreviousValue(t)||"";i.worker.queueAction(h.KEY_PRESS,{ctx:i.rec.getPath(),id:i.tree.get(t).id,v0:r,v1:s}),i._updateKnownValue(t,s),i._logElScroll(t)}}),this.rec.bind(e,"keyup",function(e){var s=e.target||e.srcElement;t.isControlKey(e)||i._logCaretInfo(s)})):"SELECT"==r?(this.rec.bind(e,"change",function(e){var t=e.target||e.srcElement;i._serializeInput(t)}),this.rec.bind(e,"blur",function(e){var t=e.target||e.srcElement;i._serializeInput(t)})):"INPUT"==r&&"CHECKBOX,RADIO".indexOf(s)>-1&&this.rec.bind(e,"change",function(e){var t=e.target||e.srcElement;i._serializeInput(t)})},s._queueFocusEvent=function(e,t){this.worker.queueAction(h.FOCUS_BLUR,{ctx:this.rec.getPath(),id:this.tree.get(e).id,v:t})},s._serializeInput=function(e,t){var i,s=(e.getAttribute("type")||"TEXT").toUpperCase(),r=e.tagName.toUpperCase();if(this._inputs.has(e)&&this.tree.get(e))if("TEXTAREA"===r||"INPUT"==r&&-1=="CHECKBOX,RADIO".indexOf(s)){if(i=e.value||"",this._updateKnownValue(e,i)&&!t){var n=this._getCaretInfo(e);this._queueInputSerialize(e,s,r,{textValue:i,cInfo:n})}}else if("SELECT"===r){i=e.selectedIndex;var o=null!==e.getAttribute("multiple");o&&e.selectedOptions&&(i=Array.prototype.map.call(e.selectedOptions,function(t){return Array.prototype.indexOf.call(e.options,t)}),t=!1),this._updateKnownValue(e,"number"==typeof i?i:i.join(","))&&!t&&(o?this._queueInputSerialize(e,s,r,{isMultiSelect:o,selectedList:i}):this._queueInputSerialize(e,s,r,{isMultiSelect:o,selected:i}))}else"INPUT"===r&&(i=e.checked,this._updateKnownValue(e,i)&&!t&&this._queueInputSerialize(e,s,r,{checked:i}))},s._queueInputSerialize=function(e,t,i,s){var r=s.textValue,n=s.cInfo,o=s.isMultiSelect,a=s.selected,c=s.selectedList,l=s.checked,u={ctx:this.rec.getPath(),id:this.tree.get(e).id,t:t,n:i,v:r,cs:n&&n.s,ce:n&&n.e,m:o,so:c,s:a,ch:l};for(var d in u)null==u[d]&&delete u[d];this.worker.queueAction(h.INPUT_SERIALIZE,u)},s._getCaretInfo=function(e){return"input"===e.tagName.toLowerCase()&&S.indexOf(e.type.toLowerCase())<0?null:e&&null!=e.selectionStart?{s:e.selectionStart,e:e.selectionEnd}:void 0},s._logCaretInfo=function(e,t){var i=this._getCaretInfo(e),s=this._inputs.get(e);if(i&&s){var r=s.caret=s.caret||{};(t||r.s!==i.s||r.e!==i.e)&&(this.worker.queueAction(h.CARET_INFO,{ctx:this.rec.getPath(),id:this.tree.get(e).id,s:i.s,e:i.e}),r.s=i.s,r.e=i.e,this._logElScroll(e))}},s._logElScroll=function(e){var t=this._inputs.get(e);if(t){var i=t.caret=t.caret||{},s=Math.round(e.scrollLeft),r=Math.round(e.scrollTop);i.sx===s&&i.sy===r||(i.sx=s,i.sy=r,this.worker.queueAction(h.SCROLL_EL,{ctx:this.rec.getPath(),id:this.tree.get(e).id,x:i.sx,y:i.sy}))}},s._stopWatchingInput=function(e){t.Unbind(e),this._inputs.delete(e)},s._scanInputValues=function(){var e=this;this._inputs.forEach(function(t,i){e._serializeInput(i)})},s.untrackInputs=function(e){var i=this;this._inputs.forEach(function(s,r){1===e.nodeType&&t.DOMContains(e,r)&&i._stopWatchingInput(r)})},s.dispose=function(){var e=this;this._inputs.forEach(function(t,i){e._stopWatchingInput(i)})},i}(),S="text|search|password|tel|url".split("|"),w=function(){function e(e,t,i){this.dom=e,this.tree=t,this.modifier=i,this.roots=new Set,this.checked=new Set}var t=e.prototype;return t.reset=function(){this.roots.clear(),this.checked.clear()},t.dispose=function(){this.reset(),this.dom=null,this.tree=null},t.addChangedEl=function(e){this.roots.add(e)},t.checkAll=function(){return this.reset(),this.roots.add(this.dom),this.check()},t.check=function(){var e=this,t=!0;return this.roots.forEach(function(i){var s=e.tree.get(i);s&&!e._checkEl(i,s)&&(t=!1)}),t},t._checkEl=function(e,t){if(this.checked.has(e))return!0;this.checked.add(e);var i=!0;return this.tree.get(e)!==t&&(console.error("Node mismatch",t,e),i=!1),t.t!==e.nodeType&&(console.error("Name mismatch at node",t,e),i=!1),t.n&&t.n!==e.nodeName&&(console.error("Name mismatch at node",t,e),i=!1),t.v&&t.v!==e.nodeValue&&(console.error("Value mismatch at node",t,e),i=!1),this._syncChildren(e,e.childNodes,t.c)||(i=!1),i},t._syncChildren=function(e,t,i){for(var s,r,n=!0,o=t.length,a=i.length,c=Math.min(o,a),l=0,u=o-1,d=a-1;l<c&&this.tree.get(t[l])===i[l];l++)this._checkEl(t[l],i[l])||(n=!1);for(;u>=l&&d>=l&&this.tree.get(t[u])===i[d];u--,d--)this._checkEl(t[u],i[d])||(n=!1);if(d++,l>=++u&&l>=d)return n;if(l<u&&l>=d){for(;l<u;l++)s=this.tree.add(e,t[l]),this.modifier.add(t[l],s,l);return!1}if(l<d&&l>=u){for(;l<d;d--)r=this.tree.idEl.get(i[l].id),s=this.tree.remove(r),this.modifier.remove(r,s);return!1}for(var h=l;h<d;h++)r=this.tree.idEl.get(i[l].id),s=this.tree.remove(r),this.modifier.remove(r,s);for(;l<u;l++)s=this.tree.add(e,t[l]),this.modifier.add(t[l],s,l);return!1},e}(),I=function(){function t(t,i,s,r,n,o,a,c){var l;if(e.ext(this,{fr:t,config:i,masker:s,worker:r,newInfoScanner:n,inputCap:a,ctx:o,tree:c},!1),"MutationObserver"!==(l=void 0!==window.__zone_symbol__MutationObserver?window.__zone_symbol__MutationObserver:void 0!==window.WebKitMutationObserver?window.WebKitMutationObserver:MutationObserver).name){var u=new l(function(){});u.__zone_symbol__originalInstance?l=u.__zone_symbol__originalInstance.constructor:u._zone$originalInstance&&(l=u._zone$originalInstance.constructor)}this.ob=new l(this._handleMutation.bind(this)),this.ob.observe(t.document.documentElement,{childList:!0,attributes:!0,characterData:!0,subtree:!0,attributeOldValue:!1})}var i=t.prototype;return i._handleMutation=function(e){var t,i,s,r,n,o,a,c,l,u,d=this,f=[],p=this.worker,g=this.masker,m=[],v=this.tree,_=!1,S=new w(this.fr.document.documentElement,v,{add:function(e,t,i){d._addElement(f,m,e,t,i)},remove:function(e,t){d._removeElement(f,e,t)}});l=g.piiObj.noRules?function(){return 0}:function(e,t){e=e||0;var i=(t.tagName||"").toUpperCase();return 1===t.nodeType&&"SCRIPT"!=i&&"LINK"!=i&&"IFRAME"!=i?e+1:e+0};var I=0;for(i=0;i<e.length;i++)if((t=e[i]).addedNodes.length>0?I+=Array.prototype.reduce.call(t.addedNodes,l,I):"attributes"!==t.type||"class"!==t.attributeName&&"fsrVisibile"!==t.attributeName&&"id"!==t.attributeName||I++,"childList"===t.type&&v.get(t.target))for(s=0;s<t.removedNodes.length;s++)I++;for(I>0&&(_=g.updateMaskingTargets()),i=0;i<e.length;i++)if(r=(t=e[i]).target,n=v.get(r),"attributes"==t.type){if(!n)continue;if(n.a=n.a||{},u=r.getAttribute(t.attributeName),"href"!==t.attributeName&&"src"!==t.attributeName||!r[t.attributeName]||"A"===r.nodeName||"AREA"===r.nodeName||"SCRIPT"===r.nodeName||(u=r[t.attributeName]),u===n.a[t.attributeName])continue;n.a[t.attributeName]=u,f.push({e:h.ATTR_MODIFIED,d:{ctx:this.ctx,id:n.id,attr:t.attributeName,val:n.a[t.attributeName],tn:n.n,r:n.a.rel||0}})}else if("characterData"==t.type){if(!n)continue;n.v=r.nodeValue,f.push({e:h.CHAR_DATA,d:{ctx:this.ctx,id:n.id,v:r.nodeValue}})}else{if("childList"!=t.type)throw new Error("Unknown type: "+t.type);S.addChangedEl(r);for(var E=0;E<t.removedNodes.length;E++)o=t.removedNodes[E],v.get(o)&&(n=this.tree.remove(o),this._removeElement(f,o,n));for(var b=0;b<t.addedNodes.length;b++)o=t.addedNodes[b],a=v.get(o),(c=v.get(r))&&!a&&this.fr.document.documentElement.contains(o)&&o.parentNode&&v.get(o.parentNode)&&(a=v.add(o.parentNode,o),c=v.getById(a.p),this._addElement(f,m,o,a,c.c.indexOf(a)))}S.check(),_&&g.sendMaskingTargets(p,v,this.ctx),f.length>0&&p.queueAction(h.MOD_LIST,f),m.length>0&&this.newInfoScanner(m)},i._removeElement=function(e,t,i){this.inputCap.untrackInputs(t),e.push({e:h.NODE_REMOVED,d:{ctx:this.ctx,id:i.id,s:void 0}})},i._addElement=function(e,t,i,s,r){var n=JSON.parse(JSON.stringify(s));e.push({e:h.NODE_ADDED,d:{ctx:this.ctx,tree:n,idx:r,s:void 0}}),1===i.nodeType&&-1==t.indexOf(i)&&t.push(i)},i.dispose=function(){this.ob.disconnect(),this.fr=null,this.newInfoScanner=null},t}(),E=function(){function i(t,i,s,r,n,o,a,c,l,u){var d,f,v=this;if(e.ext(this,{config:i,masker:o,worker:a,browser:t,rec:c,recTop:c.getTop(),ctx:l||0,isXDRIFrameMode:s,isTop:r,fr:n,_framesBeingTracked:[],isMousedOverPage:!0,lastOrientation:{alpha:0,beta:0,gamma:0},lastSizes:{},tree:u||new g},!1),this.tree.scan(n.document.documentElement),this.inputCap=new _(o,a,c,this.tree),this._serializeDom(),this.mutation=new I(n,i,o,a,function(e){v.inputCap.scanForInputs(e),v.scanForIframes(e)},l,this.inputCap,this.tree),this.inputCap.scanForInputs([n.document.body]),r){var S=this._getHiddenKeys();this.rec.bind(window,S.visibilityChange,function(){v.worker.queueAction(h.PAGE_VISIBLE,{ctx:0,v:!document[S.hidden]})}),this.rec.bind(c.win.document,"mouseout",function(e){if(v.isMousedOverPage){var t=e.relatedTarget||e.toElement,i=v.mouseMoveCapture;!i||!i.trigger||t&&"HTML"!==t.nodeName||(i.trigger(),v.isMousedOverPage=!1,v.worker.queueAction(h.WINDOW_MOUSEOUT_MOUSEENTER,{ctx:0,v:!1}))}}),this.rec.bind(c.win.document,"mouseenter",function(){v.isMousedOverPage||(v.isMousedOverPage=!0,v.worker.queueAction(h.WINDOW_MOUSEOUT_MOUSEENTER,{ctx:0,v:!0}))}),this.sizeCapture=new m(c.win,c.getBindNS()+":resize",750,function(e){var t=v.rec,i=p.getViewportSizePos(t.win);v.lastSizes.lw===i.lw&&v.lastSizes.lh===i.lh||(v.worker.queueAction(h.FRAME_SIZE,{ctx:0,w:i.lw,h:i.lh,vw:i.vw,vh:i.vh}),v.lastSizes.lw=i.lw,v.lastSizes.lh=i.lh),v.lastSizes.pw===i.pw&&v.lastSizes.ph===i.ph||(v.worker.queueAction(h.DOC_SIZE,{ctx:0,w:i.pw,h:i.ph}),v.lastSizes.pw=i.pw,v.lastSizes.ph=i.ph),v._handleScroll(e,!0)})}this.rec.bind(c.win,"error",function(e){if(v.recordedErrors=(v.recordedErrors||0)+1,!(v.recordedErrors>50))if(e.message)v.worker.queueAction(h.JAVASCRIPT_ERROR,{ctx:v.ctx,v:e.message,l:e.lineno,cl:e.colno,s:e.source,st:e.error&&e.error.stack});else{var t=e.target;if(t){var i=v.tree.get(t);v.worker.queueAction(h.ASSET_ERROR,{ctx:v.ctx,tg:i&&i.id,a:i&&i.a,ts:e.timeStamp})}}}),t.isMobile||(f=t.isIE?c.win.document:c.win,this.mouseMoveCapture=r?new m(f,this.rec.getBindNS()+":mousemove",150,this._handleMouseEvents.bind(this)):this.recTop.cap.mouseMoveCapture.merge(f,this.rec.getBindNS()+":mousemove",this,!0),this.rec.bind(c.win.document,"mousedown",function(e){if(v.mouseMoveCapture){v.mouseMoveCapture.trigger();var t=v.tree.get(e.target),i=v.recTop.cap.lastMousePosition;i&&v.worker.queueAction(h.MOUSE_DOWN,{ctx:0,x:Math.round(i.x),y:Math.round(i.y),id:t&&t.id})}}),this.rec.bind(c.win.document,"mouseup",function(e){v.mouseMoveCapture.trigger();var t=v.tree.get(e.target),i=v.recTop.cap.lastMousePosition;i&&v.worker.queueAction(h.MOUSE_UP,{ctx:0,x:Math.round(i.x),y:Math.round(i.y),id:t&&t.id})}),this.rec.bind(c.win.document,"click",function(e){v.mouseMoveCapture.trigger();var t=v.tree.get(e.target),i=v.recTop.cap.lastMousePosition;i&&v.worker.queueAction(h.MOUSE_CLICK,{ctx:0,x:Math.round(i.x),y:Math.round(i.y),id:t&&t.id})}));var w=["start","end","cancel","leave","move"];for(d=0;d<w.length;d++)this.rec.bind(c.win.document,"touch"+w[d],function(e){return function(t){this._handleTouchEvents(t,e)}}(w[d]).bind(this),{passive:!0});if(r){this.rec.bind(this.rec.win,"orientationchange",function(){var e=v.rec,t=!1,i=p.getViewportSizePos(e.win);e.win.orientation>=-90&&e.win.orientation<=90&&(t=!0),v.worker.queueAction(h.ORIENTATION_CHANGE,{ctx:0,x:i.vx,y:i.vy,isL:t,lw:i.lw,lh:i.lh,pw:i.pw,ph:i.ph,vw:i.vw,vh:i.vh}),v.lastSizes.vw=i.vw,v.lastSizes.vh=i.vh,v.lastSizes.lw=i.lw,v.lastSizes.lh=i.lh})}r&&window.visualViewport&&(this.rec.bind(window.visualViewport,"resize",this._handleScroll.bind(this)),this.rec.bind(window.visualViewport,"scroll",this._handleScroll.bind(this))),this.rec.bind(n,"scroll",this._handleScroll.bind(this)),this.scanForIframes([n.document.body])}var s=i.prototype;return s._getHiddenKeys=function(){var e,t;return void 0!==document.hidden?(e="hidden",t="visibilitychange"):void 0!==document.msHidden?(e="msHidden",t="msvisibilitychange"):void 0!==document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange"),{hidden:e,visibilityChange:t}},s._serializeDom=function(){var i=this.fr.document,s=this.browser.browser,r=t.getScreenResolution(),n=p.getViewportSizePos(this.fr),o=this.fr.location.href.toString(),a=this._getHiddenKeys(),c=!1;this.lastSizes=n,this.fr.orientation>=-90&&this.fr.orientation<=90&&(c=!0),this.worker.queueAction(h.PAGE_MARKER,{ctx:this.ctx,parent:this.rec.recordParent?this.rec.recordParent.instancePath:this.ctx,dt:p.getDocType(this.browser,i),doc:JSON.parse(JSON.stringify(this.tree.get(i.documentElement))),maskingTargets:this.masker.getCurrentMaskingTargetIds(this.tree),url:o,v:this.browser.agent,start:e.startTS,tz:(new Date).getTimezoneOffset(),domloadtime:t.now()-e.startTS,cid:e.globalConfig.replayId,customerId:e.globalConfig.customerId,userId:this.recTop.stg.uid,f:document.referrer.toString(),t:this.fr.document.title,bn:s.name,bv:s.version,dw:r.w,dh:r.h,pw:n.pw,ph:n.ph,lw:n.lw,lh:n.lh,vw:n.vw,vh:n.vh,landscape:c,mobile:this.browser.isMobile,whiteListMode:this.masker.piiObj.useWhiteListing,sid:this.rec.getSessionId(),gid:this.rec.getGlobalId(),vs:!document[a.hidden],scroll:{x:n.vx,y:n.vy}})},s._handleScroll=function(e,i){if(this.rec){var s,r,n,o,a=e.target,c={x:a.scrollLeft,y:a.scrollTop},l=this.rec.win,u=this.recTop;a===l.document||a===l.visualViewport||i?(o=p.getViewportSizePos(l),l!==l.top||this.lastSizes.vw===o.vw&&this.lastSizes.vh===o.vh||(this.worker.queueAction(h.ZOOM,{ctx:0,vw:o.vw,vh:o.vh,lw:o.lw,lh:o.lh}),this.lastSizes.vw=o.vw,this.lastSizes.vh=o.vh),this.lastSizes.vx===o.vx&&this.lastSizes.vy===o.vy||(this.worker.queueAction(h.FRAME_SCROLL,{ctx:this.rec.getPath(),x:o.vx,y:o.vy}),this.lastSizes.vx=o.vx,this.lastSizes.vy=o.vy),u.cap&&this.isMousedOverPage&&(s=u.cap._lastUnscrolledMouse,r=u.cap.lastMousePosition,s&&(n=t.getScroll(u.win),s.x+n.x===r.x&&s.y+n.y===r.y||this.worker.queueAction(h.MOUSE_MOVE,{ctx:0,x:Math.round(s.x+n.x),y:Math.round(s.y+n.y)})))):this.worker.queueAction(h.SCROLL_EL,{ctx:this.rec.getPath(),id:this.tree.get(a).id,x:Math.round(c.x),y:Math.round(c.y)})}},s._handleTouchEvents=function(i,s){if(this.rec){var r,n,o,a=[];if(e.isDefined(i.touches))for(r=0;r<i.touches.length;r++){n=i.touches[r],o=this.tree.get(n.target);var c=Math.round(n.pageX),l=Math.round(n.pageY);if(this.recTop!==this.rec){var u=this.rec.win.frameElement,d=p.getPositionRelativeToMainView(u,p.getParentWindow(u),!1),f=t.getScroll(this.rec.win);d&&(c+=d.x-f.x,l+=d.y-f.y)}a.push({n:n.identifier,x:c,y:l,id:o&&o.id})}this.worker.queueAction(h.TOUCH,{ctx:0,ts:a,et:s}),("end"===s||a.length>1)&&this._handleScroll(i,!0)}},s._handleMouseEvents=function(i,s,r){if(this.isMousedOverPage&&i){var n={x:void 0!==i.clientX?i.clientX:void 0!==i.screenX?i.screenX:i.sX,y:void 0!==i.clientY?i.clientY:void 0!==i.screenY?i.screenY:i.sY},o=r?r.rec:this.rec;if(o){var a=t.getScroll(o.win),c={x:a.x+n.x,y:a.y+n.y};if(this._lastUnscrolledMouse=n,r)if(r.isXDRIFrameMode)c.x+=o.ifrFrameOffset.x-a.x,c.y+=o.ifrFrameOffset.y-a.y;else{var l=o.win.frameElement,u=p.getPositionRelativeToMainView(l,p.getParentWindow(l),!1),d=t.getScroll(this.recTop.win);u&&(c.x+=u.x-a.x,c.y+=u.y-a.y),this._lastUnscrolledMouse=e.ext({},c),this._lastUnscrolledMouse.x-=d.x,this._lastUnscrolledMouse.y-=d.y}this.recTop.cap.lastMousePosition&&c.x===this.recTop.cap.lastMousePosition.x&&c.y===this.recTop.cap.lastMousePosition.y||(this.recTop.cap.lastMousePosition=c,this.worker.queueAction(h.MOUSE_MOVE,{ctx:0,x:Math.round(c.x),y:Math.round(c.y)}))}}},s.getFrameWindow=function(e){var t;return e&&e.contentWindow?t=e.contentWindow:e&&e.contentDocument&&e.contentDocument.defaultView&&(t=e.contentDocument.defaultView),t&&t!=t.top?t:null},s.isFrameSameOrigin=function(e,i){if(e.getAttribute("srcdoc")&&!e.getAttribute("src"))return!0;var s=e.getAttribute("src");if(!s)return!1;for(var r=["javascript:","about:blank"],n=0;n<r.length;n++)if(s.indexOf(r[n])>-1)return!1;if(!s||0===s.indexOf(" "))return!1;var o=e.src;if(!t.testSameDomain(i||window.location.href,o))return!1;try{var a=this.getFrameWindow(e);a.__test=!0,delete a.__test}catch(c){return!1}return!0},s.bindToFrame=function(t,i){var s,r=this;i.__fsrec__=s=this.rec.newIframeRecorder(i,this.tree.get(t).id,this.tree),this.rec.bind(i,"unload",function(){e.nextTick(function(){s.dispose(),delete i.__fsrec__,r._framesBeingTracked.splice(r._framesBeingTracked.indexOf(t),1),r.scanForIframes([t.parentNode])})},!0)},s.scanForIframes=function(i){for(var s=this._framesBeingTracked,r=0;r<i.length;r++)if(i[r]){var n=i[r].querySelectorAll("iframe");if(n.length>0)for(var o=Array.prototype.filter.call(n,function(e){return-1==s.indexOf(e)}),a=0;a<o.length;a++)if(s.push(o[a]),this.isFrameSameOrigin(o[a])){var c=this.getFrameWindow(o[a]);c.__fsrec__||("complete"===c.document.readyState||"interactive"===c.document.readyState?e.nextTick(function(e,t){return function(){this.bindToFrame(e,t)}}(o[a],c).bind(this)):t.BindOnce(c,this.rec.getBindNS()+":load",function(e,t){return function(){this.bindToFrame(e,t)}}(o[a],c).bind(this)))}}},s.dispose=function(){this.mutation&&this.mutation.dispose(),this.mouseMoveCapture&&this.recTop===this.rec&&this.mouseMoveCapture.dispose(),this.orientationCapture&&this.orientationCapture.dispose(),this.sizeCapture&&this.sizeCapture.dispose(),this.inputCap&&this.inputCap.dispose();var e=this.tree.get(this.fr.document.documentElement);e&&(this.tree.remove(this.fr.document.documentElement),this.worker.queueAction(h.MOD_LIST,[{e:h.NODE_REMOVED,d:{ctx:this.ctx,id:e.id}}]))},i}(),b=function(){function i(e,t){this.win=t,this.doc=t.document,this.piiObj=this._prepPIIObjectForPage(e,t),this.maskEls={masked:new Set,unmasked:new Set,redact:new Set,whitelist:new Set}}var s=i.prototype;return s._prepPIIObjectForPage=function(i,s){var r,n=JSON.parse(JSON.stringify(i)),o=e.toLowerCase(e.getParam("fsrurl")||s.location.href||"about:blank"),a=!0,c=!1;for(n.staticBlockEls&&(n.selectiveMaskZones=e.ext(n.selectiveMaskZones||{},n.staticBlockEls),delete n.staticBlockEls,c=!0),n.dynamicBlockEls&&(n.selectiveMaskZones=e.ext(n.selectiveMaskZones||{},n.dynamicBlockEls),delete n.dynamicBlockEls,c=!0),n.selectiveMaskZones=n.selectiveMaskZones||{},n.staticVisibleEls&&(n.selectiveUnMaskZones=e.ext(n.selectiveUnMaskZones||{},n.staticVisibleEls),n.visibleInputs=e.ext(n.visibleInputs||{},n.staticVisibleEls),delete n.staticVisibleEls,c=!0),n.dynamicVisibleEls&&(n.selectiveUnMaskZones=e.ext(n.selectiveUnMaskZones||{},n.dynamicVisibleEls),n.visibleInputs=e.ext(n.visibleInputs||{},n.dynamicVisibleEls),delete n.dynamicVisibleEls,c=!0),n.staticWhiteListEls&&(n.selectiveUnMaskZones=e.ext(n.selectiveUnMaskZones||{},n.staticWhiteListEls),n.visibleInputs=e.ext(n.visibleInputs||{},n.staticWhiteListEls),delete n.staticWhiteListEls,c=!0),n.dynamicWhiteListEls&&(n.selectiveUnMaskZones=e.ext(n.selectiveUnMaskZones||{},n.dynamicWhiteListEls),n.visibleInputs=e.ext(n.visibleInputs||{},n.dynamicWhiteListEls),delete n.dynamicWhiteListEls,c=!0),n.selectiveUnMaskZones=n.selectiveUnMaskZones||{},n.removeVisibilityEls&&(n.redactZones=e.ext(n.redactZones||{},n.removeVisibilityEls),delete n.removeVisibilityEls,c=!0),n.obscureEls&&(n.redactZones=e.ext(n.redactZones||{},n.obscureEls),delete n.obscureEls,c=!0),n.assetBlockEls&&(n.redactZones=e.ext(n.redactZones||{},n.assetBlockEls),delete n.assetBlockEls,c=!0),n.redactZones=n.redactZones||{},null==n.pagesToSelectiveMask&&(n.pagesToSelectiveMask=[],c&&0===Object.keys(n.selectiveUnMaskZones).length&&(n.pagesToSelectiveMask=Object.keys(n.selectiveMaskZones))),c&&console.warn("sr: upgraded config to: pii:",JSON.stringify(n,null,2),"\n(to make this message disappear, please upgrade to new record config format)"),r=0;r<n.pagesToSelectiveMask.length;r++)if(t.testAgainstSearch(n.pagesToSelectiveMask[r],o)){a=!1;break}function l(e,i,s){var r,n=e[i],o=Object.keys(n||{}),a=[];for(r=0;r<o.length;r++)t.testAgainstSearch(o[r]||"*",s)?a.push(n[o[r]]):delete n[o[r]];return e[i]=a.join(",").trim(),0==a.length&&(delete e[i],!0)}return n.useWhiteListing=a,delete n.pagesToSelectiveMask,a?(delete n.selectiveMaskZones,n.noRules=l(n,"selectiveUnMaskZones",o)):(n.noRules=l(n,"selectiveMaskZones",o),delete n.selectiveUnMaskZones),l(n,"visibleInputs",o),l(n,"redactZones",o),n},s.getCurrentMaskingTargets=function(){var e=this.maskEls,t={};return["unmasked","masked","whitelist","redact"].forEach(function(i){var s=[];e[i].forEach(function(e){return s.push(e)}),t[i]=s}),t},s.getCurrentMaskingTargetIds=function(t){var i=this.getCurrentMaskingTargets(),s=function(e){return t.get(e)&&t.get(e).id},r=function(t){return e.isDefined(t)};return{unmasked:i.unmasked.map(s).filter(r),masked:i.masked.map(s).filter(r),whitelist:i.whitelist.map(s).filter(r),redact:i.redact.map(s).filter(r)}},s.sendMaskingTargets=function(e,t,i){var s=this.getCurrentMaskingTargetIds(t);e.queueAction(h.MASKING_CHANGE,{ctx:i,targets:s})},s.updateMaskingTargets=function(){var e=this.piiObj,t=this.doc,i=this.maskEls,s=!1;if(e.visibleInputs){var r=t.querySelectorAll("input, select, textarea")||[];r=Array.prototype.filter.call(r,function(t){var i=!1;return void 0!==t.matches?i=t.matches(e.visibleInputs):void 0!==t.msMatchesSelector?i=t.msMatchesSelector(e.visibleInputs):void 0!==t.matchesSelector&&(i=t.matchesSelector(e.visibleInputs)),i}),this.updateMaskingListWithElements(r,i.whitelist)&&(s=!0)}return this.updateMaskingList(e.redactZones,i.redact)&&(s=!0),this.updateMaskingList(e.selectiveUnMaskZones,i.unmasked)&&(s=!0),this.updateMaskingList(e.selectiveMaskZones,i.masked)&&(s=!0),s},s.updateMaskingList=function(e,t){if(e){var i=this.doc.querySelectorAll(e);return this.updateMaskingListWithElements(i,t)}return!1},s.updateMaskingListWithElements=function(e,t){for(var i=!1,s=new Set,r=0;r<e.length;r++)t.has(e[r])||(t.add(e[r]),i=!0),s.add(e[r]);return t.forEach(function(e){s.has(e)||(t.delete(e),i=!0)}),i},s.dispose=function(){for(var e in this.maskEls)this.maskEls[e].clear()},i}(),T=36e5,y=function(){function i(i,s){e.ext(this,{config:s,stg:i,beginTransmitting:new t.FSEvent,endSessionEvent:new t.FSEvent,siteId:e.globalConfig.replayId||"unk"},!1);var r=i.get([u.GLOBALSESSIONID,u.TRANSMITTING,u.CANCELED,"pv",u.DONOTRECORD]),n=r[u.GLOBALSESSIONID],o=r[u.TRANSMITTING]||!1,a=t.now();if(!0!==r[u.DONOTRECORD]){n||(n=this._generateSID());var c,l=this._backup_storage=new t.DomStorage(this.siteId,!1,!1),d=Math.floor(1024*(s.advancedSettings.maxStorageMB||0)*1024);if((c=s.advancedSettings.useSessionStorage?this._storage=new t.SeshStorage(this.siteId,!1,d):this._storage=new t.WindowStorage(this.siteId,d)).isNew()&&!l.isNew())c.set(u.SESSION,l.get(u.SESSION)),c.setBlob(l.getBlob());else if(!c.isNew()&&l.isNew()){var h=c.get(u.SESSION);h&&(n=h[u.GLOBALSESSIONID]),c.setBlob(c.getBlob())}var f=c.get(u.SESSION),p=!1;("m"!==n[0]||f&&"m"!==f[u.SESSIONID][0])&&(p=!0);var g=parseInt(i.get(u.GLOBALREFRESHTIME),10);if((!isNaN(g)||p)&&(a-g>T||p)&&(n=this._generateSID(),f=null,o=!1,c.eraseAll(),i.erase(u.GLOBALSESSIONID),e.supportsDomStorage))try{localStorage.removeItem(u.TRANSMITTING),localStorage.removeItem(u.DONOTRECORD)}catch(m){}f?(o=f[u.TRANSMITTING],f[u.PAGENUM]=(f[u.PAGENUM]||0)+1):(o=!1,(f={})[u.SESSIONID]=this._generateSID(),f[u.GLOBALSESSIONID]=n,f[u.TRANSMITTING]=o,f[u.PAGENUM]=0),i.set(u.TRANSMITTING,o),i.set(u.GLOBALSESSIONID,n),i.set(u.GLOBALREFRESHTIME,a),c.set(u.SESSION,f),this.sessionInfo=f,c.commit(),l&&t.Bind(window,"beforeunload",function(){l.set(u.SESSION,c.get(u.SESSION)),l.commit()}),o?this.beginTransmitting.fire():this._stateCheckInterval=setInterval(this._checkTransmittingState.bind(this),5e3)}else this.DONOTRECORD=!0}var s=i.prototype;return s._generateSID=function(){return"m"+t.generateGUID().substr(1)},s._checkTransmittingState=function(){var t=!1;if(e.supportsDomStorage)try{t="yes"==localStorage.getItem(u.TRANSMITTING)}catch(i){}t||(t=this.isTransmitting()),t&&(clearInterval(this._stateCheckInterval),this.beginTransmitting.fire())},s.isTransmitting=function(){return!!this.sessionInfo[u.TRANSMITTING]},s.getPageNum=function(){var e=this._storage.get(u.SESSION);return e&&e[u.PAGENUM]||0},s.setTransmitting=function(){if(e.supportsDomStorage)try{localStorage.setItem(u.TRANSMITTING,"yes")}catch(t){}clearInterval(this._stateCheckInterval),this.stg.set(u.TRANSMITTING,!0),this.sessionInfo[u.TRANSMITTING]=!0,this._storage.set(u.SESSION,this.sessionInfo),this._storage.commit(),this.beginTransmitting.fire()},s.clear=function(){var t=this.stg;if(clearInterval(this._stateCheckInterval),t.erase(u.TRANSMITTING),t.erase(u.GLOBALSESSIONID),t.erase(u.GLOBALREFRESHTIME),e.supportsDomStorage)try{localStorage.removeItem(u.TRANSMITTING),localStorage.removeItem(u.DONOTRECORD)}catch(i){}this._storage.eraseAll(),this._backup_storage.eraseAll(),this.DONOTRECORD=!0},s.endSession=function(){if(this.clear(),this.stg.set(u.DONOTRECORD,!0,T),e.supportsDomStorage)try{localStorage.setItem(u.DONOTRECORD,"yes")}catch(t){}this.endSessionEvent.fire()},s.getGlobalId=function(){return this.sessionInfo[u.GLOBALSESSIONID]},s.getSessionId=function(){return this.sessionInfo[u.SESSIONID]},s.dispose=function(){clearInterval(this._stateCheckInterval)},i}(),O=function(){function i(i){e.ext(this,{sesh:i,siteId:e.toLowerCase(i.siteId.replace(/[^a-zA-Z0-9]*/g,"")),_shouldTransmit:!1,_isTransmitting:!1,_gotFirstPacket:!1,_failedTransmits:0,_prevTimestamp:t.now()},!1),i.beginTransmitting.subscribe(this._startTransmitting.bind(this),!0,!0),i._storage.StorageFull.subscribe(this._emptyStorage.bind(this),!1,!1)}var s=i.prototype;return s.enqueue=function(e){this.save(e),this._gotFirstPacket=!0,this._transmit()},s.save=function(e){if(!this.sesh.DONOTRECORD){var t=this.sesh._storage,i=t.get("rpls")||[];i.push({when:this._getMonotonicTimestamp(),data:e,pn:this.sesh.getPageNum()}),t.set("rpls",i),t.commit()}},s.dispose=function(){this._shouldTransmit&&!this.sesh.DONOTRECORD&&this._sendAllWithoutWaiting()},s._startTransmitting=function(){this._shouldTransmit=!0,this._gotFirstPacket&&this._transmit()},s._emptyStorage=function(){if(this._shouldTransmit)return this._actuallyTransmit();var e=this.sesh._storage,t=e.get("rpls")||[];if(t.length>0)for(var i=t[0].pn;t[0].pn===i;)t.shift();e.set("rpls",t),e.commit()},s._transmit=function(){this._shouldTransmit&&this._actuallyTransmit()},s._sendAllWithoutWaiting=function(){var e=this.sesh._storage.get("rpls")||[];e.length&&t.sendWithoutWaiting(this._buildUrl(),{data:e},!0)},s._buildUrl=function(){return e.globalConfig.recUrl+"rest/web/event/"+e.enc(r.jrny.customerId)+"/"+e.enc(this.sesh.getGlobalId())+"/"+e.enc(this.sesh.getSessionId())+"?domain="+e.enc(document.domain)+"&site_id="+e.enc(this.siteId)+"&version="+e.enc("symlink"==e.globalConfig.codeVer?"19.7.0":e.globalConfig.codeVer)},s._actuallyTransmit=function(){var e=this,i=this.sesh,s=this.sesh._storage,n=s.get("rpls")||[],o=null;n.length<1||(this._isTransmitting||(this._isTransmitting=!0,o=n.length<=3?{data:n}:{data:n.slice(0,3)},(new t.AjaxTransport).send({method:"POST",contentType:"application/json",url:this._buildUrl(),data:o,failure:function(t,s){e._isTransmitting=!1,r.jrny.addEventString(l),5==~~(s/100)?e._failedTransmits=20:e._failedTransmits++,e._failedTransmits>20&&i&&i.endSession()},success:function(t){(t=JSON.parse(t)).ids&&(n=(n=s.get("rpls")||[]).filter(function(e){return-1==t.ids.indexOf(e.when)}),s.set("rpls",n),s.commit()),n.length<1||!e._shouldTransmit?e._isTransmitting=!1:setTimeout(function(){e._isTransmitting=!1,e._actuallyTransmit()},500)}})))},s._getMonotonicTimestamp=function(){var e=t.now();return e<=this._prevTimestamp&&(e=this._prevTimestamp+1),this._prevTimestamp=e,e},i}(),k=50,M=100,x=function(){function s(i,s){e.ext(this,{sesh:i,worker:s,transmitter:new O(i),eventsBuffer:[],partialBuffer:[],firstPacket:!0,_maybeTransmitQueue:t.debounce(this.transmitQueue.bind(this),k,M)},!1)}var r=s.prototype;return r.receive=function(e){this.partialBuffer=[],this.transmitter.enqueue(e)},r.receivePartial=function(e){this.partialBuffer=this.partialBuffer.concat(e)},r.send=function(e){this.eventsBuffer.push(e),this.firstPacket?(this.firstPacket=!1,this.transmitQueue()):this._maybeTransmitQueue()},r.flush=function(){this._maybeTransmitQueue.cancel(),this.transmitQueue()},r.transmitQueue=function(){this.eventsBuffer.length>0&&(this.worker.sendEvents(this.eventsBuffer),this.eventsBuffer=[])},r.emergencySavePartialState=function(){if(0!==this.partialBuffer.length&&!this.sesh.DONOTRECORD){var e=i.compress(JSON.stringify(this.partialBuffer));this.transmitter.save(e)}},r.dispose=function(){this.emergencySavePartialState(),this.transmitter.dispose()},s}(),N={INIT:"INIT",DISPOSE:"DISPOSE",EVENTS:"EVENTS",WRAPUP:"WRAPUP",UNCORK:"UNCORK"},A=function(){function i(i,s,r,n){var o=this;e.ext(this,{config:i,sesh:s,masker:n,stg:r,mule:new x(s,this),_lastEventTime:e.startTS},!1);var a=e.makeURI("$fs.recordworker.js"),c=e.makeURI("$fs.compress.js");0===c.indexOf("//")&&(c=location.protocol+c),this._sendMessage(N.INIT,{pii:this.masker&&this.masker.piiObj,compressUrl:c}),this.sesh.beginTransmitting.subscribe(this._uncorkWorker.bind(this),!0,!0),"http"!==a.substr(0,4)&&"//"!==a.substr(0,2)||0===a.indexOf(location.origin)?this._initWorker(a):(new t.AjaxTransport).send({method:"GET",url:a,blob:!0,success:function(e){var t=window.mozURL||window.msURL||window.webkitURL||window.URL;o._initWorker(t.createObjectURL(e))}})}var s=i.prototype;return s._initWorker=function(e){var t=this;if(!this._disposed){this.wrkr=new Worker(e,{name:"fs.recordworker.js"}),this.wrkr.__zone_symbol__addEventListener?this.wrkr.__zone_symbol__addEventListener("message",this._handleMessage.bind(this),!0):this.wrkr.addEventListener("message",this._handleMessage.bind(this),!0);var i=this._queue;delete this._queue,i&&i.forEach(function(e){return t.wrkr.postMessage(e)})}},s._handleMessage=function(e){if(e.data&&e.data.messageType&&null!=e.data.data&&!this._disposed){var t=e.data;switch(t.messageType){case"PAYLOAD":if(""===t.data)return void this.sesh.endSession();this.mule.receive(t.data);break;case"PARTIAL":this.mule.receivePartial(t.data)}}},s._sendMessage=function(e,t){var i={messageType:e,data:t||{}};if(!this.wrkr)return this._queue=this._queue||[],void this._queue.push(i);this.wrkr.postMessage(i)},s._uncorkWorker=function(){this._sendMessage(N.UNCORK),this.flush()},s.sendEvents=function(e){e.length>0&&!this._disposed&&this._sendMessage(N.EVENTS,e)},s.flush=function(){this._disposed||(this.mule.flush(),this._sendMessage(N.WRAPUP))},s.queueAction=function(e,i,s){return s=s||t.now(),this.mule.send({e:e,td:s-this._lastEventTime,d:i}),this._lastEventTime=s,s},s.dispose=function(){this._disposed=!0,this.mule.dispose(),this._sendMessage(N.DISPOSE),this.wrkr&&this.wrkr.terminate()},i}(),C=function(){function i(i,s,r,n,o,a,c,l,u,d,f,p,g){var m=this;if(e.ext(this,{browser:s,config:a,stg:i,win:r,ready:new t.FSEvent,isIframeMode:!!l,recordParent:o,instancePath:n,iFrameParentFr:d,ifrid:u,skipPage:g},!1),this.win.document){if(this.sesh=o&&o.sesh?o.sesh:new y(i,a),this.sesh.DONOTRECORD)return;if(this.sesh.endSessionEvent.subscribe(this.dispose.bind(this)),g||(this.masker=new b(a.advancedSettings.pii,this.win),this.masker.updateMaskingTargets()),this.worker=o&&o.worker?o.worker:new A(a,this.sesh,i,this.masker),g){var v=this.win.location.href.toString();this.worker.queueAction(h.PAGE_MARKER,{ctx:this.getPath(),parent:this.recordParent?this.recordParent.instancePath:0,dt:null,doc:null,url:v,v:this.browser.agent,start:e.startTS,tz:(new Date).getTimezoneOffset(),domloadtime:t.now()-e.startTS,cid:e.globalConfig.replayId,customerId:e.globalConfig.customerId,userId:this.getTop().stg.uid,f:document.referrer.toString(),t:document.title,bn:this.browser.name,bv:this.browser.version,dw:0,dh:0,pw:0,ph:0,lw:0,lh:0,vw:0,vh:0,landscape:null,mobile:this.browser.isMobile,whiteListMode:null,sid:this.getSessionId(),gid:this.getGlobalId(),vs:!0,scroll:{x:0,y:0}}),e.nextTick(function(){m.worker.queueAction(h.NOT_RECORDED,{ctx:m.getPath()}),m.worker.flush()})}else this.cap=new E(s,this.config,this.isIframeMode,this.getTop()===this,r,this.masker,this.worker,this,n,c);this.ready.fire()}}var s=i.prototype;return s.newIframeRecorder=function(e,t,s){return new i(this.stg,this.browser,e,t,this,this.config,s,this.isIframeMode)},s.getTop=function(){return this.recordParent?this.recordParent.getTop():this},s.getPath=function(){return this.instancePath},s.getBindNS=function(){return"record"+this.getPath()},s.bind=function(e,i,s,r){t.Bind(e,this.getBindNS()+":"+i,s,r)},s.setTransmitOK=function(){this.sesh.setTransmitting()},s.flush=function(){this.worker&&this.worker.flush()},s.clearState=function(){this.sesh.clear(),this.dispose()},s.getGlobalId=function(){return this.sesh.getGlobalId()},s.getSessionId=function(){return this.sesh.getSessionId()},s.getPIIConfig=function(){return this.masker&&this.masker.piiObj},s.getMaskingTargets=function(){return this.masker&&this.masker.getCurrentMaskingTargets()},s.processImmediately=function(i){(new t.AjaxTransport).send({method:"GET",url:e.globalConfig.recUrl+"process/"+e.enc(this.getGlobalId())+"?version="+e.enc("symlink"==e.globalConfig.codeVer?"19.7.0":e.globalConfig.codeVer)+"&delay="+(i||0),failure:function(){},success:function(){}})},s.sendCustomEvent=function(e,t,i,s){i=i||t,s=JSON.stringify(s||{}),i.length>256&&(i=i.substr(0,256)),s.length>1e4&&(s=JSON.stringify({msg:R})),this.worker.queueAction(e,{msg:i,meta:s})},s.dispose=function(){return!this.disposed&&(this.disposed=!0,this.masker&&this.masker.dispose(),this.ready.unsubscribeAll(),this.getTop()===this&&(this.worker.dispose(),this.sesh.dispose()),this.cap&&this.cap.dispose(),t.Unbind(this.getBindNS()+":*"),!0)},i}(),R="Meta object too large",P=null,D=function(){function i(){var i=arguments[2];this.jrny=r.jrny=new t.Journey({customerId:e.globalConfig.customerId||t.getRootDomain()||"record_customerId",appId:t.APPID.REPLAY,stg:i,browser:arguments[0],useSessionId:!0,usePopupId:!1}),this.jrny.addEventsDefault("properties",{fs_pageViews:[i.get("pv")]}),this.initialize.apply(this,arguments)}var s=i.prototype;return s.isIframe=function(){return window!=window.top},s.isCrossDomainFrame=function(){if(this.isIframe())try{return window.top.document.body.toString().length.length<0}catch(e){return!0}return!1},s.initialize=function(i,s,r,n,a){var l=this,u=e.getProductConfig("record");if(!(u&&u.advancedSettings&&u.advancedSettings.pii&&u.advancedSettings.browser_cutoff))throw new Error("Looks like record is trying to run without a config. Please push a proper config for record to fix this error.");if("undefined"!=typeof Uint8Array){var h=this.isIframe(),p=this.isCrossDomainFrame();if(!h||p){if(n&&e.ext(u.advancedSettings||{},n),this.winobj=s,this.browser=i,u&&u.instances)for(var g=0;g<u.instances.length;g++){var m=u.instances[g];if(!m.disabled){e.ext(u,m);break}}this.crit=new d(u,i,a),this.stg=r,r.ready.subscribe(function(){i.ready.subscribe(function(){if(l.crit.supported()||l.crit.didSkipOnPurpose){var n=l.stg.get(["pv"]);p?t.Bind(window,"message",function(o){if(o.data+="",o.data&&e.isFunction(o.data.indexOf)&&o.data.length>3&&o.data.indexOf("{")>-1){var c;try{c=JSON.parse(o.data)}catch(d){return}c.src&&"fsframe"==c.src||(c.cxr&&c.id?(l.recorder=new C(r,i,s,c.xp,null,u,null,p,c.id,o.source,c.sid,c.sp),l.recorder.ready.subscribe(function(){a.set("replay_id",l.recorder.getGlobalId()),a.set("replay_session_id",l.recorder.getSessionId()),f.ready(l)},!0,!0),n.rt||"x"!==n.i||l.beginTransmitting(),t.Bind(window,"unload",function(){if(l.recorder){var e=l.recorder.ifrid;window.top.postMessage({unloadiFrame:!0,frameId:e},"*"),l.recorder.dispose(),delete l.recorder}})):c.cxsp&&l.recorder&&l.recorder.setXFrameScrollPosition(c.sp))}}):(l.recorder=new C(r,i,s,0,null,u,null,p,null,null,null,null,!!l.crit.didSkipOnPurpose),l.recorder.ready.subscribe(function(){a.set("replay_id",l.recorder.getGlobalId()),a.set("replay_session_id",l.recorder.getSessionId()),f.ready(l)},!0,!0),l.jrny&&1===n.pv&&l.jrny.addEventString(o),t.Bind(window,"beforeunload",function(){l.recorder&&(l.recorder.dispose(),delete l.recorder)}))}else f.ready(l)},!0,!0)},!0,!0)}}else this.jrny&&this.jrny.addEventString(c)},s.beginTransmitting=function(){this.recorder&&this.recorder.setTransmitOK()},s.dispose=function(){this.recorder&&(this.recorder.dispose(),delete this.recorder,P=null)},s.cancelRecord=function(){this.recorder&&(this.recorder.clearState(),delete this.recorder),this.jrny&&this.jrny.addEventString(a)},s.getGlobalId=function(){return this.recorder&&this.recorder.getGlobalId()},s.getSessionId=function(){return this.recorder&&this.recorder.getSessionId()},s.sendCustomEvent=function(e,t,i,s){return this.recorder&&this.recorder.sendCustomEvent(e,t,i,s)},i}();return D.getInstance=function(e,t,i,s,r){return null===P&&(P=new D(e,t,i,s,r)),P},D.disposeInstance=function(){P&&(P.dispose(),P=null)},D});
