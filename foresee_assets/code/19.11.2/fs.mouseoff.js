/***************************************
 * @preserve
 * Copyright (c) 2019 Verint Systems, Inc. All rights reserved.
 * ForeSee Web SDK: mouseoff
 * Version: 19.11.2
 * Built: November 07, 2019, 12:47:06 CST
 ***************************************/
_fsDefine(["fs",_fsNormalizeUrl("$fs.utils.js"),"exports"],function(e,t,s){return function(){function s(t,s,o,n,i){e.ext(this,{browser:o,gstg:n,journey:i,trigger:t,surveydef:s,mode:e.toLowerCase(s.mouseoff.mode)},!1),e.supportsDomStorage?"lasttab"!=this.mode||!o.isIE&&"Edge"!=o.browser.name||(this.mode="multitab"):this.mode="off"}var o=s.prototype;return o.initialize=function(){var e,s,o,n,i,f,a=this,u=0,r=0,m=t.now(),d=m;this.mousemoveHandler=function(e){(m=t.now())-d>100&&(n=Math.sqrt(Math.pow(e.pageX-u,2)+Math.pow(e.pageY-r,2))/(m-d),u=e.pageX,r=e.pageY,d=m)},this.mouseleaveHandler=function(t){var m,d,g,l;document.hasFocus()&&(m=u,d=r,g=t.pageX,l=t.pageY,s=window.pageYOffset,e=window.pageXOffset,o=window.innerWidth,f=(s-(l-(i=(l-d)/(g-m))*g))/i-e,isNaN(f)&&(f=g),l<d&&f>=0&&f<=o)&&(a.dispose(),a.gstg._sync(function(){a.gstg.get("i")||(a.trigger.cpps.set("mouseoff",!0),a.journey.addEventsDefault("properties",{fs_inviteType:["mouseoff"]}),a.surveydef.mouseoff.sp&&a.surveydef.mouseoff.sp.reg&&a.journey.addEventsDefault("properties",{fs_samplePercentage:[a.surveydef.mouseoff.sp.reg]}),a.surveydef.mouseoff.lf&&a.journey.addEventsDefault("properties",{fs_loyaltyFactor:[a.surveydef.mouseoff.lf]}),a.journey.addEventObj({name:"fs_mouseoff",metrics:{fs_mouseoff_speed:n,fs_mouseoff_slope:Math.max(i,-9999),fs_mouseoff_pagewidth:o,fs_mouseoff_xintercept:f,fs_mouseoff_xpercentage:f/o,fs_mouseoff_pagenumber:a.gstg.get("pv")}}),a.successCb())}))}},o.startListening=function(e,s){var o,n=this.surveydef.mouseoff.minPageTime||0,i=this.surveydef.mouseoff.minSiteTime||0,f=this.gstg.get("sst")+i-t.now(),a=Math.max(n,f);if(this.storagePrefix="lthb_",this.startCb=e||function(){},this.successCb=s||function(){},"multitab"===this.mode)o=this.startListeningMultiTab;else{if("lasttab"!==this.mode)return;this.setupStorageKeys(),o=this.startListeningLastTab}this.timeout=setTimeout(o.bind(this),a)},o.startListeningMultiTab=function(){this.startCb(),t.Bind(document.documentElement,"mouseoff:mousemove",this.mousemoveHandler,!0),t.Bind(document.documentElement,"mouseoff:mouseleave",this.mouseleaveHandler,!0),this.setupInviteStatusWatching()},o.setupStorageKeys=function(){var e="safari"===this.br?"onbeforeunload":"unload",s=this.tabKey=sessionStorage.getItem("fsrMouseOff"),o=this.storagePrefix;s&&!function(e){for(var t in localStorage)if(t===o+e)return!0;return!1}(s)||(s=Math.round(1e6*Math.random()),sessionStorage.setItem("fsrMouseOff",s)),localStorage.setItem(o+s,1),t.Bind(window,"mouseoff:"+e,function(){localStorage.removeItem(o+s)})},o.startListeningLastTab=function(){var e,s,o,n=this,i=this.storagePrefix,f=function(f){f&&f.key&&0!==f.key.indexOf(i)||(o=function(){for(var t in e=0,s=[],localStorage)0===t.indexOf(i)&&(++e,s.push(t));return 1===e}(),n.gstg.get("i")?n.dispose():o&&!n.listening?(n.startCb(),t.Bind(document.documentElement,"mouseoff:mousemove",n.mousemoveHandler,!0),t.Bind(document.documentElement,"mouseoff:mouseleave",n.mouseleaveHandler,!0),n.listening=!0):o||(t.Unbind(document.documentElement,"mouseoff:mousemove",n.mousemoveHandler),t.Unbind(document.documentElement,"mouseoff:mouseleave",n.mouseleaveHandler),n.listening=!1))};this.setupInviteStatusWatching(),f(),t.Bind(window,"mouseoff:storage",f)},o.setupInviteStatusWatching=function(){var e=this;this.gstg.setUpdateInterval(1e4),this.gstg.watchForChanges(["i"],function(){e.gstg.setUpdateInterval(6e4),e.dispose()},!0,!0)},o.dispose=function(){t.Unbind("mouseoff:*"),clearTimeout(this.timeout),localStorage.removeItem(this.storagePrefix+this.tabKey)},s}()});
