/***************************************
 * @preserve
 * Copyright (c) 2019 Verint Systems, Inc. All rights reserved.
 * ForeSee Web SDK: Tracker Window
 * Version: 19.11.2
 * Built: November 07, 2019, 12:47:06 CST
 ***************************************/
_fsDefine(["fs",_fsNormalizeUrl("$fs.utils.js"),"exports"],function(e,t,i){var r=function(){function i(t,i,r,a){this.cfg=t,this.globalConfig=t.globalConfig||e.globalConfig,this.cpps=i,this.def=r,this.locale=i.get("locale")||"en",this.qual=a}var r=i.prototype;return r.decideModernSurvey=function(){var e=this.cfg.config.abSurveyType,t=e&&e.shouldTest&&this.globalConfig.modernSurveyUrl&&a(e,this.def);return this.cfg.config.onlyModernSurvey?{modernChosen:!0,modernPercentage:100}:t?{modernChosen:t.modernPercentage>=Math.floor(100*Math.random()),modernPercentage:t.modernPercentage}:{modernChosen:!1,modernPercentage:0}},r.getMeasureId=function(){return[this.def.name,this.def.site,this.def.section,this.locale,this.qual?this.qual.qualifiesValue:null].filter(function(e){return e}).join("-")},r.getUrl=function(){var e=this.decideModernSurvey();if(e.modernChosen)return this._buildUrl(this.globalConfig.modernSurveyUrl,this._getParams({}));var i=t.now()+"_"+Math.round(1e13*Math.random()),r=this._getParams({a:i,b:t.hash(i),c:864e5,mp:e.modernPercentage});return this._buildUrl(this.globalConfig.surveyUrl,r)},r._getParams=function(t){return e.ext({sid:this.getMeasureId(),cid:this.globalConfig.customerId,pattern:this.cpps.get(this.def.pattern)||this.def.pattern},t||{},!1)},r._buildUrl=function(t,i){var r=t+"?";for(var a in i)r+=e.enc(a)+"="+e.enc(i[a])+"&";return r+=this.cpps.toQueryString(["browser","os"])},r.getShortSurveyUrl=function(e){var t=e.pageView,i=e.paginationType,r=e.midOverride;try{if(1===t&&sessionStorage.removeItem("FSR_SSURL"),t>1){var a=sessionStorage.getItem("FSR_SSURL");if(a)return a}}catch(o){}var s=this.globalConfig.modernSurveyUrl,n=this._getParams({template:"contextual",pv:t,paginationType:i});return r&&(delete n.cid,delete n.sid,n.mid=r),n.paginationType||delete n.paginationType,this._buildUrl(s,n)},r.getShortSurveyOrigin=function(){return e.globalConfig.modernSurveyUrl.replace(/\/sv$/,"")},i}(),a=function(e,t){var i,r,a,s=t.name||"";for(s+="-"+(t.section||""),s+="-"+(t.site||""),i=0;i<e.defs.length;i++)if(r=(a=e.defs[i]).name||"",r+="-"+(a.section||""),(r+="-"+(a.site||""))===s)return a;return null},s=function(){function t(t){this.gs=t,this._extras={},this.config=e.globalConfig}var i=t.prototype;return i._isCPPEnabled=function(e){return!this.config.disable_cpps||this.config.disable_cpps.indexOf(e)<0},i.set=function(e,t){this._isCPPEnabled(e)&&(this.all()[e]=t,this._extras[e]=t)},i.get=function(e){return this.all()[e]},i.all=function(){return e.ext({},this.gs.get("cp")||{},this._extras)},i.toQueryString=function(t){void 0===t&&(t=[]);var i=[],r=this.all();for(var a in r)t.indexOf(a)<0&&i.push("cpp["+e.enc(a)+"]="+e.enc(r[a]));return i.join("&")},i.erase=function(e){var t=this.all();delete t[e],this.gs.set("cp",t)},i.append=function(e,t,i){if(this._isCPPEnabled(e)){var r=this.gs.get("cp")||{};if(r[e]=(r[e]||"")+","+t,i){var a=r[e].split(","),s=a.length-1,n=a.length>i?a.length-i:0;r[e]=a.splice(n,s-n+1).join()}this.gs.set("cp",r)}},t}(),n=function(){function i(i,r,a,s,n,o){var l,c=this;this.br=i,this.data=a,this.qual=s,this.cpps=r,this.templatehtml=n,this.displayOpts=o,this.userLocale=this.data.cfg.active_surveydef.language.locale||"en",this.qualified=new t.FSEvent,this.disqualified=new t.FSEvent,this.validationFailed=new t.FSEvent,this.qualifiesValue=null,"en"!==this.userLocale&&e.isDefined(this.data.cfg.active_surveydef.qualifier.survey.locales[this.userLocale])&&(this.qual.survey=e.ext({},this.data.cfg.active_surveydef.qualifier.survey.locales[this.userLocale]));for(var u=this.qual.survey.questions.length,d=0;d<u;d++){l=this.qual.survey.questions[d];for(var f=0;f<l.choices.length;f++)e.ext(l.choices[f],{id:"q"+d+"c"+f,value:"q"+d+"c"+f,name:"q"+d,type:e.toLowerCase(l.questionType)})}this.disqualified.subscribe(function(){c.showNoThanks()}),this.validationFailed.subscribe(function(e){alert(e)})}var r=i.prototype;return r.render=function(){var i=this,r=e.ext({},this.displayOpts,{qual:this.qual});document.documentElement.setAttribute("id","fsrQualifier"),document.body.innerHTML=this.templatehtml(r),t.Bind(document.getElementById("qualifierForm"),"qualifier:submit",function(e){t.preventDefault(e),i.validateAndSubmit()}),t.Bind(document.getElementById("qualCancelButton"),"qualifier:click",function(e){t.preventDefault(e),i.disqualified.fire()}),t.Bind(document.getElementById("qualCloseButton"),"qualifier:click",function(e){t.preventDefault(e),window.close()})},r.validateAndSubmit=function(){for(var e=document.querySelectorAll(".activeQuestion"),t=[],i=!1,r=0;r<e.length;r++){var a=parseInt(e[r].getAttribute("questionNum"),10),s=this.qual.survey.questions[a];if("RADIO"==s.questionType){for(var n=document.getElementsByName("q"+a),o=!1,l=0;l<n.length;l++)if(n[l].checked){o=!0,t.push(s.choices[l]);break}if(!o){i=!0;break}}}if(i)this.validationFailed.fire(this.qual.survey.validationFailedMsg);else{for(var c=!1,u=0;u<t.length;u++){var d=t[u];if(this.qualifiesValue=d.qualifies||null,d.cpps&&d.cpps.length>0)for(var f=0;f<d.cpps.length;f++)for(var h in d.cpps[f])this.cpps.set(h,d.cpps[f][h]);if(!1===d.qualifies){c=!0;break}}!0===c?this.disqualified.fire():this.qualified.fire()}},r.showNoThanks=function(){t.addClass(document.getElementById("fsrQualifierMain"),"acsNoDisplay"),t.removeClass(document.getElementById("fsrQualifierNoThanks"),"acsNoDisplay")},i}(),o=function(){function i(e,i,r,a,s,n){this.br=e,this.data=r,this.rmdr=a,this.lng=r.cfg.active_surveydef.language.locale,this.cpps=i,this.templatehtml=s,this.displayOpts=n,this.accepted=new t.FSEvent}return i.prototype.render=function(){var i=this;document.documentElement.setAttribute("id","fsrReminder");var r=e.ext({},this.rmdr);"en"!==this.lng&&e.isDefined(this.rmdr.display.locales[this.lng])&&(r.display=this.rmdr.display.locales[this.lng]);var a,s=e.ext({},this.displayOpts,{rmdr:r});document.body.innerHTML=this.templatehtml(s);var n=document.getElementById("reminderForm");n?a="submit":(a="click",n=document.querySelector(".fsrBeginSurvey")),t.Bind(n,"reminder:"+a,function(e){t.preventDefault(e),i.accepted.fire()})},i}();e.globalConfig.brainUrl=e.getParam("brain_url")||e.globalConfig.brainUrl;var l="fs_trackerShown",c="fs_trackerClicked",u="fs_qualifierAccepted",d="fs_qualifierDeclined",f="fs_qualifierShown",h="fs_reminderShown",g="fs_reminderAccepted",m=function(){function i(i,r,a){var n=this,o=a.cfg.config,l=a.cfg.globalConfig;for(var c in l)e.globalConfig[c]=l[c];this.br=i,this.stg=r,this.data=a,this._stage=1,this.jrny=new t.Journey({customerId:l.customerId||t.getRootDomain()||"tracker_customerId",appId:t.APPID.TRIGGER,stg:r,browser:i,throttleDuration:50,useSessionId:!1,usePopupId:!0}),this.jrny.config=l;var u=this.data.cfg.active_surveydef;this.jrny.addEventsDefault("properties",{fs_site:[t.getRootDomain()],fs_repeatDaysAccept:[o.repeatDays.accept],fs_repeatDaysDecline:[o.repeatDays.decline],fs_reinviteDelayAfterInviteAbandon:[o.reinviteDelayAfterInviteAbandon],fs_defName:[u.name],fs_section:[u.section],fs_displayName:[this.data.display.displayname],fs_displayTemplate:[this.data.display.template],fs_language:[u.locale],fs_samplePercentage:[u.criteria.sp.reg],fs_loyaltyFactor:[u.criteria.lf]}),this.cpps=new s(this.stg),this.cpps.config=l,e.ext(this.cpps._extras,a.cpps),this._loadResources(function(){document.documentElement.style.backgroundImage="none",n.ready.fire(),n.br.isIE||r.onCommit.subscribe(function(){r.get("page_hb")||(r.onCommit.unsubscribeAll(),n.launchSurveyOrQualifier(),n.data.display.removeSurveyAlerts||setTimeout(function(){var t=e.toLowerCase(navigator.userAgent);-1==t.indexOf("msie")&&-1==t.indexOf("edge")&&-1==t.indexOf("firefox")&&n.data.display.dialog&&alert(n.data.display.dialog.surveyavailable)},200))})}),this.ready=new t.FSEvent}var a=i.prototype;return a.update=function(e,t,i){this.br=e,this.stg=t,this.data=i},a.setCPPS=function(e){if(e)for(var t in this.jrny.addEventsDefault("properties",{fs_pvInvited:[e.pv]}),e)this.cpps.set(t,e[t])},a._loadResources=function(i){var r=this;if(this.data&&this.data.template&&"string"==typeof this.data.template){var a=this.data.template,s=a.indexOf("@")>-1,n=e.makeURI("templates/trigger/"+a+"/main.css"),o=e.makeURI("templates/trigger/"+a+"/tracker.html"),l=e.makeURI("templates/trigger/"+a+"/qualifier.html"),c=e.makeURI("templates/trigger/"+a+"/reminder.html"),u=e.getParam("gw");s&&(a=a.substr(1),e.isSelfHosted?(n=e.makeAssetURI("trigger/templates/"+a+"/main.css"),o=e.makeAssetURI("trigger/templates/"+a+"/tracker.html"),l=e.makeAssetURI("trigger/templates/"+a+"/qualifier.html"),c=e.makeAssetURI("trigger/templates/"+a+"/reminder.html")):(n=u.replace(/__gwtest__/g,"templates/"+a+"/main.css"),o=u.replace(/__gwtest__/g,"templates/"+a+"/tracker.html"),l=u.replace(/__gwtest__/g,"templates/"+a+"/qualifier.html"),c=u.replace(/__gwtest__/g,"templates/"+a+"/reminder.html"))),this.queue=new t.Async(!0,function(){if(i)return i()},function(){}),this.queue.enqueue(function(e){t.loadCSS(n,function(t){r._cssLink=t,e&&e.resolve()},null,r.br)}),this.queue.enqueue(function(e){new t.TemplateFetcher({success:function(t){r.templatehtml=t,e&&e.resolve()}}).get(o)}),this.queue.enqueue(function(e){new t.TemplateFetcher({success:function(t){r.qualhtml=t,e&&e.resolve()}}).get(l)}),this.queue.enqueue(function(e){new t.TemplateFetcher({success:function(t){r.rmdrhtml=t,e&&e.resolve()}}).get(c)})}},a.renderTemplate=function(){var i=this,r=this.data.cfg.active_surveydef.language.locale||"en";this.data.display.inviteType=this.data.display.inviteType.toUpperCase();var a=e.ext({copyrightDate:(new Date).getFullYear().toString(),supportsSVG:document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")},this.data.display,this.data.cfg.config),s=e.getParam("gw");a.trackerLogo&&a.trackerLogo.length&&(e.isDefined(e.assetLocation)&&"undefined"!=e.assetLocation?a.trackerLogo=e.makeAssetURI("trigger/"+a.trackerLogo):a.trackerLogo=s.replace(/__gwtest__/g,a.trackerLogo)),a.trackerBanner&&a.trackerBanner.length&&(e.isDefined(e.assetLocation)&&"undefined"!=e.assetLocation?a.trackerBanner=e.makeAssetURI("trigger/"+a.trackerBanner):a.trackerBanner=s.replace(/__gwtest__/g,a.trackerBanner)),a.vendorLogo&&a.vendorLogo.length&&(a.vendorLogo=e.makeAssetURI(a.vendorLogo)),a.vendorLogoPNG&&a.vendorLogoPNG.length&&(a.vendorLogoPNG=e.makeAssetURI(a.vendorLogoPNG)),a.trusteLogo&&a.trusteLogo.length&&(a.trusteLogo=e.makeAssetURI(a.trusteLogo)),a.loadImg=e.makeURI("loadimg.gif"),this._displayOpts=a,document.title=a.dialog.trackerTitle,document.body.innerHTML=this.templatehtml(a),document.documentElement.setAttribute("lang",r),this._doSizing(),this._cvTimeout?2==this._stage&&this._convertTracker():this._cvTimeout=setTimeout(function(){i._stage=2,i._convertTracker()},this.data.cfg.config.trackerConvertsAfter),t.Bind(window,"tracker:resize",function(){i._doSizing()}),this.jrny.addEventString(l)},a._doSizing=function(){var e=document.querySelectorAll("*[acsfill=true]"),i=t.getSize(window);if(e)for(var r=0;r<e.length;r++){var a=e[r],s=a.offsetLeft,n=a.offsetTop;a.style.height=i.h-n-1*s+"px"}var o=document.querySelectorAll("*[acscentervertically=true]");if(o)for(var l=0;l<o.length;l++){var c=o[l],u=c.offsetHeight,d=c.parentNode.offsetHeight;c.style.marginTop=(d-u)/2+"px"}},a._convertTracker=function(){var e,i=this,r=document.querySelectorAll(".initialContent");for(e=0;e<r.length;e++)t.addClass(r[e],"acsNoDisplay fsrNoDisplay");var a=document.querySelectorAll(".showLater");for(e=0;e<a.length;e++)t.addClass(a[e],"acsDisplay fsrDisplay");this._doSizing(),t.addClass(document.body,"acsActiveTracker");var s=document.querySelectorAll("*[acsactivatebutton=true], .fsrBeginSurvey"),n=function(){i.jrny.addEventString(c),i.launchSurveyOrQualifier()},o=function(e){13===(window.event?e.which:e.keyCode)&&n()};for(e=0;e<s.length;e++)t.Bind(s[e],"click",n),t.Bind(s[e],"keydown",o)},a.launchSurveyOrQualifier=function(){this._cvTimeout&&(clearTimeout(this._cvTimeout),this._cvTimeout=null);for(var e=document.querySelectorAll("*[acsshowwhenloading=true]"),i=0;i<e.length;i++)t.addClass(e[i],"acsDisplay");for(var r=document.querySelectorAll("*[acshidewhenloading=true]"),a=0;a<r.length;a++)t.removeClass(r[a],"acsDisplay"),t.addClass(r[a],"acsNoDisplay");var s=this.data.cfg.active_surveydef.qualifier,n=this.data.cfg.active_surveydef.reminder,o=!!document.querySelector("main.fsrTracker");s&&s.useQualifier?o?this.goToSurvey():this.goToQualifier():n&&n.useReminder?this.goToReminder():this.goToSurvey()},a.goToQualifier=function(){var e=this;this.qualifier=new n(this.br,this.cpps,this.data,this.data.cfg.active_surveydef.qualifier,this.qualhtml,this._displayOpts),this.qualifier.qualified.subscribe(function(){e.jrny.addEventString(u),e.goToSurvey()},!0,!1),this.qualifier.disqualified.subscribe(function(){e.jrny.addEventString(d)},!0,!1),this.qualifier.render(),this.jrny.addEventString(f)},a.goToReminder=function(){var e=this;this.reminder=new o(this.br,this.cpps,this.data,this.data.cfg.active_surveydef.reminder,this.rmdrhtml,this._displayOpts),this.reminder.accepted.subscribe(function(){e.jrny.addEventString(g),e.goToSurvey()},!0,!1),this.reminder.render(),this.jrny.addEventString(h)},a.goToSurvey=function(){var e=this,i=this.stg.get("ipt"),a=(t.now()-i)/1e3;this.cpps.set("invite_presented_interval",a);var s=new r(this.data.cfg,this.cpps,this.data.cfg.active_surveydef,this.qualifier).getUrl();window.resizeBy(0,200),window.focus(),setTimeout(function(){e._doSizing(),window.location=s},100)},i}();function p(){var i,r=setTimeout(function(){window.close()},13e3),a=new t.Browser,s=5e3;a.ready.subscribe(function(){var n=t.getBrainStorage(a,e.getParam("uid")),o=window.setTimeout(v,3e4);n._readyState.subscribe(y,!1,!0),n.ready.subscribe(function(){n._readyState.unsubscribe(y),window.clearTimeout(o);var l=window.setInterval(function(){var e=n.get("trackerinfo");e?(delete n._data.keys.page_hb,n.set("tracker_hb",t.now(),2*e.hb_i,!0)):n._sync()},1e3);function c(e,i,a){if(e&&i&&a){var o=new m(e,i,a);return o.ready.subscribe(function(){clearTimeout(r),o.renderTemplate()},!0,!0),clearInterval(l),l=window.setInterval(function(){delete n._data.keys.page_hb,n.set("tracker_hb",t.now(),2*a.hb_i,!0)},s),o}}i=c(a,n,n.get("trackerinfo")),n.watchForChanges(["trackerinfo","trackercmd","ckcpps"],function(t,r,s){if("trackercmd"==t)switch(s.method){case"close":window.close();break;case"survey":i&&i.goToSurvey&&i.goToSurvey()}else if("ckcpps"==t&&i)e.ext(i.cpps._extras,s);else if("trackerinfo"==t)if(e.isDefined(i)){var o=i.data.cfg.active_surveydef,l=s.cfg.active_surveydef;if(!e.isDefined(l))return;if(o.name!==l.name||o.site!==l.site||o.section!==l.section||o.language&&o.language.locale!=l.language.locale){if(i.data.template!==s.template)return;i.update(a,n,s),i.renderTemplate()}}else i=c(a,n,s)},!1,!0)},!0,!0)},!0,!0)}function v(){window.close()}function y(e){e._serverFails>0&&window.close()}return i.startup=function(){e.winReady(p)},i});
