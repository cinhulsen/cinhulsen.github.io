/***************************************
 * @preserve
 * Copyright (c) 2019 Verint Systems, Inc. All rights reserved.
 * ForeSee Web SDK: Feedback
 * Version: 19.11.2
 * Built: November 07, 2019, 12:47:06 CST
 ***************************************/
_fsDefine(["fs",_fsNormalizeUrl("$fs.utils.js"),_fsNormalizeUrl("$fs.survey.js"),_fsNormalizeUrl("$fs.compress.js"),"exports"],function(e,t,i,s,n){var r={remove:function(){this.parentNode&&this.parentNode.removeChild(this)},hasClass:function(e){return this.className.indexOf(e)>-1},addClass:function(e){this.hasClass(e)||(this.className+=" "+e)},removeClass:function(e){this.className=(this.className||"").replace(e,""),this.className=this.className.replace(/[ ]+$/g,"")},$:function(e){return this.querySelectorAll(e)},css:function(t){for(var i in t)e.hasProp(t,i)&&(this.style[i]=t[i])}},o=function(t){if("string"==typeof t&&-1==t.indexOf("<"))return document.querySelectorAll(t);if("string"==typeof t){var i=document.createElement("div");i.innerHTML=t,t=i.firstChild}for(var s in r)e.hasProp(r,s)&&(t[s]=r[s]);return t},a=function(){function t(){var t=o('<img src="'+e.makeURI("$loader.gif")+'" class="acs-loader">');t.setAttribute("alt","loading survey"),this.$el=t}var i=t.prototype;return i.center=function(e){var t=this.$el.parentNode.offsetWidth,i=this.$el.offsetWidth;this.$el.css({left:(t-i)/2+"px",top:e?(t-i)/2+"px":"auto"})},i.remove=function(){this.$el.parentNode.removeChild(this.$el)},t}(),c={onFeedbackSubmitted:new t.FSEvent,onFeedbackShown:new t.FSEvent,onFeedbackClosed:new t.FSEvent,onModalCssRetrieved:new t.FSEvent},d=function(){function i(e,i,s,n,r,a){var c=this;this.sv=e,this.br=i,this.cfg=s,this.jrny=s.jrny,this.errTemplate=n,this.svTemplate=r,this.epTemplate=a,this.$domContent=[],this.$btns=[],this.networkError=new t.FSEvent,this.SurveySubmitted=new t.FSEvent,this.ajax=new t.AjaxTransport;for(var d=d||window,l=d.document.body.childNodes,h=0;h<l.length;h++)1===l[h].nodeType&&o(l[h]).hasClass("_acs")?this.$btns.push(l[h]):this.$domContent.push(l[h]);this.$el=o('<div class="acsMainContainerFullPage--'+this.sv.cfg.template+'"></div>'),this.sv.cfg.privacyuri=this.sv.cfg.privacyuri?this.sv.cfg.privacyuri:"http://www.foresee.com/about-us/privacy-policy/",this.sv.cfg.privacytext=this.sv.cfg.privacytext?this.sv.cfg.privacytext:"Privacy policy",this.sv.SubmitClicked.subscribe(function(){c.$content.removeClass("acsVisible"),c._showWait(),c._postSurveyData(function(){c.jrny.addEventObj({name:"feedback_submitted",properties:{mid:[s.mid]}}),c.$content.addClass("acsVisible"),c._showThankyou(),c._removeWait(),c.SurveySubmitted.fire()})}),this.networkError.subscribe(this.onNetworkError.bind(this)),this._getSurveyData(function(e){c.sv=e,c.show()})}var s=i.prototype;return s.onNetworkError=function(i){var s=this;this._removeWait(),i&&i.type?this.jrny&&this.jrny.addEventObj({name:"feedback_survey_"+i.type,properties:{mid:[this.sv.cfg.mid]}}):this.jrny&&this.jrny.addEventObj({name:"feedback_server_error",properties:{mid:[this.sv.cfg.mid]}}),this.$content=o('<div class="acsMainContainerMobile--'+this.sv.cfg.template+'"></div>'),this.$el=o('<div class="acsMainContainerFullPage--'+this.sv.cfg.template+'"></div>'),this.$closebtn=o('<span><img src="'+e.makeURI("$templates/feedback"+(this.sv.cfg.template||"default")+"/closeBtn.svg")+'" class="acsModalCloseButton"></span>'),this.$content.innerHTML=this.errTemplate(this.sv);var n=this.$content.$(".acs-serviceunavailable__message")[0];if("expired"===i.type){for(;n.firstChild;)n.removeChild(n.firstChild);this.sv.cfg.fbexpiremessage?n.appendChild(o("<p>"+this.sv.cfg.fbexpiremessage+"</p>")):n.appendChild(o("<p>This is an expired survey!</p>"))}else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(o("<p>Feedback isn't available right now.</p><p>Please check back later.</p>"))}t.Bind(this.$closebtn,"feedback:click",function(e){s.hide(e,!0)}),this.$el.appendChild(this.$closebtn),this.$el.appendChild(this.$content);var r=this.$el.$(".acs-close-button")[0];t.Bind(r,"feedback:click",function(e){s.hide(e,!0)}),this.$content.addClass("acsVisible"),window.document.body.innerHTML="",window.document.body.appendChild(this.$el)},s._renderSurvey=function(){var i=this,s=s||window,n=this,r=s.document.body;if(!this.sv.cfg.preview){t.Bind(document.body,"feedback:keyup",function e(i){"escape"==t.getKeyCode(i)&&(n.jrny.addEventObj({name:"feedback_abandoned",properties:{mid:[n.cfg.mid]}}),n.hide(i,!1)),t.Unbind(document.body,"feedback:keyup",e)})}r.innerHTML="",0===this.$el.children.length&&(this.$closebtn=o('<span><img src="'+e.makeURI("$templates/feedback/"+(this.sv.cfg.template||"default")+"/closeBtn.svg")+'" class="acsModalCloseButton"></span>'),this.$content=o('<div class="acsMainContainerMobile--'+this.sv.cfg.template+'"></div>'),this.$el.appendChild(this.$closebtn),this.$el.appendChild(this.$content)),r.appendChild(this.$el),this.sv.cfg.preview||t.Bind(this.$closebtn,"feedback:click",function(e){i.hide(e,!1)}),this._showWait()},s._showWait=function(){this._removeWait(),this._wait=new a,this.$el.appendChild(this._wait.$el),this._wait.center();var e=t.getScroll(window),i=t.getSize(window);this._wait.$el.css({position:"absolute",top:e.y+(i.h-this._wait.$el.offsetHeight)/2+"px",left:e.x+(i.w-this._wait.$el.offsetWidth)/2+"px"})},s._removeWait=function(){this._wait&&(this._wait.remove(),this._wait=null)},s.hide=function(e,t){window.document.body.innerHTML="";for(var i=0;i<this.$domContent.length;i++)window.document.body.appendChild(this.$domContent[i]);c.onFeedbackClosed.fire(),this.jrny&&e&&e.target&&!e.target.classList.contains("acs-feedback__button--epilogue")&&this.jrny.addEventObj({name:"feedback_abandoned",properties:{mid:[this.cfg.mid]}}),t||this._showBtns()},s.remove=function(e){return this.hide(null,e)},s._showBtns=function(){for(var e=0;e<this.$btns.length;e++)window.document.body.appendChild(this.$btns[e])},s.show=function(){if(this._renderSurvey(),this._removeWait(),this.sv.ansLogoSrc=e.makeURI("$p_b_foresee.svg"),0===this.$content.children.length){var t=this.svTemplate(this.sv);this.$content.innerHTML=t,this.sv.bind(this.$content)}this.$content.addClass("acsVisible"),this.$el.addClass("acsVisible"),this.sv.SurveyUIUpdated.fire(),c.onFeedbackShown.fire(this.$el),this.jrny&&this.jrny.addEventObj({name:"feedback_survey_shown",properties:{mid:[this.sv.cfg.mid]}})},s._showThankyou=function(){var i=this;this._removeWait();var s=this.epTemplate(this.sv);this.$closebtn=o('<span><img src="'+e.makeURI("$templates/feedback/"+(this.sv.cfg.template||"default")+"/closeBtn.svg")+'" class="acsModalCloseButton"></span>'),this.sv.cfg.preview||t.Bind(this.$closebtn,"feedback:click",function(e){i.hide(e,!0)},!0),this.$content.innerHTML=s,this.jrny&&this.jrny.addEventObj({name:"feedback_thankyou_shown",properties:{mid:[this.cfg.mid]}}),this.$el.removeChild(this.$el.childNodes[0]),this.$el.removeChild(this.$el.childNodes[0]),this.$el.appendChild(this.$closebtn),this.$el.appendChild(this.$content);for(var n=this.$el.$(".acs-close-button")[0],r=this.$el.$("h1"),a=0;a<r.length;a++)o(r[a]).addClass("acs-feedback__heading acs-feedback__heading--h1");this.sv.cfg.preview||t.Bind(n,"feedback:click",function(e){i.hide(e,!0)})},s._getSurveyData=function(){var e=this;if(this.sv.isExpired())this.networkError.fire({type:"expired"});else{var t={mid:this.sv.cfg.mid,cachebust:(new Date).getTime()};this.sv.cfg.version&&(t.version=this.sv.cfg.version),this._surveyTimer=setTimeout(function(){e.networkError.fire({type:"timedout"})},1e4),this.ajax.send({method:"GET",url:this.cfg.datauri,data:t,success:function(t){clearTimeout(e._surveyTimer),e.sv.SurveyData.fire(t,function(t){e.sv=t,e.show()})},failure:function(){e.networkError.fire({type:"getdata_failed"})}})}},s._postSurveyData=function(e){var t=this;if(this.sv.cfg.preview)setTimeout(function(){if(e)return e()},100);else{this._surveyTimer=setTimeout(function(){t.networkError.fire({type:"timedout"})},1e4);var i=JSON.parse(this.sv._serialize());this.jrny&&this.jrny.config&&this.jrny.config.disable_cpps&&this.jrny.config.disable_cpps.indexOf("url")>-1&&(i.url=""),this.ajax.send({method:"POST",url:this.cfg.posturi,data:i,contentType:"application/json",success:function(){if(clearTimeout(t._surveyTimer),e)return e()},failure:function(){clearTimeout(t._surveyTimer),sessionStorage.setItem("acsFeedbackSubmitted","true"),t.networkError.fire({type:"postdata_failed"})}})}},i}(),l={},h=!1;var f=function(){function i(e,i,s,n,r,a){var c=this;this.sv=e,this.cfg=e.cfg,this.instcfg=s,this.browser=i,this.em=n,this.noserv=n,this.eptemplate=a,this.jrny=e.cfg.jrny,this.add(),this.modaltemplate=r,this.ajax=new t.AjaxTransport,this.sv.cfg.privacyuri=this.sv.cfg.privacyuri?this.sv.cfg.privacyuri:"http://www.foresee.com/about-us/privacy-policy/",this.sv.cfg.privacytext=this.sv.cfg.privacytext?this.sv.cfg.privacytext:"Privacy policy",this.SurveySubmitted=new t.FSEvent,this.networkError=new t.FSEvent,this.sv.SubmitClicked.subscribe(function(){c.$content.removeClass("acsVisible"),c._showWait(),c._postSurveyData(function(){c.jrny&&c.jrny.addEventObj({name:"feedback_submitted",properties:{mid:[c.cfg.mid]}}),c.$content.addClass("acsVisible"),c._showThankyou(),c.SurveySubmitted.fire(),c._removeWait()})}),this.networkError.subscribe(function(e){c._removeWait(),e&&e.type?c.jrny&&c.jrny.addEventObj({name:"feedback_survey_"+e.type,properties:{mid:[c.cfg.mid]}}):c.jrny&&c.jrny.addEventObj({name:"feedback_server_error",properties:{mid:[c.cfg.mid]}}),c.$content.innerHTML=c.noserv(c.survey);var i=c.$content.$("h1"),s=c.$content.$(".acs-close-button")[0],n=c.$content.$(".acs-serviceunavailable__message")[0];if("expired"===e.type){for(;n.firstChild;)n.removeChild(n.firstChild);if(c.sv.cfg.fbexpiremessage)n.appendChild(o("<p>"+c.sv.cfg.fbexpiremessage+"</p>"));else{var r=c._unencodeHTML(c.sv.defaultCfg.expired);n.appendChild(o(r))}}else{for(;n.firstChild;)n.removeChild(n.firstChild);var a=c._unencodeHTML(c.sv.defaultCfg.unavailable);n.appendChild(o(a))}for(var d=0;d<i.length;d++)o(i[d]).addClass("acs-feedback__heading acs-feedback__heading--h1");c.cfg.preview||(c.positionModal(),t.Bind(s,"feedbackModal:click",function(){c.remove()})),c.$content.addClass("acsVisible")}),this._getSurveyData()}var s=i.prototype;return s._showThankyou=function(){var e=this,i=this.eptemplate(this.survey);this.$content.innerHTML=i;for(var s=this.$content.$("h1"),n=this.$content.$(".acs-close-button")[0],r=document.getElementById("fsrModalFocus"),o=0;o<s.length;o++)t.addClass(s[o],"acs-feedback__heading acs-feedback__heading--h1");this.positionModal(),this.cfg.preview||t.Bind(n,"feedbackModal:click",function(){e.remove()}),r.focus()},s._unencodeHTML=function(e){return e.replace(/&lt;/gi,"<").replace(/&gt;/gi,">")},s._showWait=function(){this._removeWait(),this._wait=new a,this.$el.appendChild(this._wait.$el),this._wait.center();var e=t.getScroll(window),i=t.getSize(window);this._wait.$el.css({top:e.y+(i.h-this._wait.$el.offsetHeight)/2+"px"})},s._removeWait=function(){this._wait&&(this._wait.remove(),this._wait=null)},s.remove=function(){this.$el&&this.$el.parentNode&&(t.Unbind("feedbackModal:*"),this.$el.parentNode.removeChild(this.$el),c.onFeedbackClosed.fire(this.$el))},s.add=function(i){var s=this,n=(i=i||window).document.body,r=i.document.documentElement,a=Math.max(n.scrollHeight,n.offsetHeight,r.clientHeight,r.scrollHeight,r.offsetHeight),c="acsModalContainer--"+this.instcfg.template,d=this.sv.cfg,l=o('<div class="acsModalBackFace"></div>'),h=o('<div class="acsModalChrome"></div>');if(this.browser.isIE&&10==this.browser.browser.version&&(c+=" acsIE10"),this.$el=o('<div class="'+c+'"></div>'),this.$el.css({height:a}),!this.cfg.preview){var f=this;t.Bind(l,"feedbackModal:click",function(){(s.survey||s.networkError.didFire)&&(f.jrny&&f.jrny.addEventObj({name:"feedback_abandoned",properties:{mid:[d.mid]}}),s.remove())});t.Bind(document.body,"feedbackModal:keyup",function(e){"escape"==t.getKeyCode(e)&&(f.jrny&&f.jrny.addEventObj({name:"feedback_abandoned",properties:{mid:[d.mid]}}),f.remove(),f.focusOnBadge())}),t.Bind(h,"feedbackModal:click",function(e){var t=e.target;t&&t==h&&(f.jrny&&f.jrny.addEventObj({name:"feedback_abandoned",properties:{mid:[d.mid]}}),f.remove(),f.focusOnBadge())})}var u=this.head=o('<div class="acsModalContent" id="acsModalContent" role="dialog" aria-labelledby="acsFeedbackDialogTitle" aria-describedby="acsFeedbackDialogDesc"></div>'),p=o('<div class="acsModalHead" role="presentation"></div>'),m=o('<img id="fsrModalFocus" src="'+e.makeURI("$templates/feedback/"+(this.instcfg.template||"default")+"/closeBtn.svg")+'" class="acsModalCloseButton" alt="Close Button" tabindex="0">');this.$head=p,p.appendChild(m),u.appendChild(p),this.$content=o('<div class="acsModalInnerContent" role="presentation"></div>'),u.appendChild(this.$content),h.appendChild(u),this.$el.appendChild(l),this.$el.appendChild(h),i.document.body.appendChild(this.$el),this.cfg.preview||(t.Bind(m,"feedbackModal:click",function(){s.jrny&&s.jrny.addEventObj({name:"feedback_abandoned",properties:{mid:[s.cfg.mid]}}),s.remove(),s.focusOnBadge()}),t.Bind(m,"feedbackModal:keypress",function(e){var i=t.getKeyCode(e);("enter"==i||"spacebar"==i)&&(s.jrny.addEventObj({name:"feedback_abandoned",properties:{mid:[s.cfg.mid]}}),s.remove(),s.focusOnBadge(),e.preventDefault())})),e.nextTick(function(){l.addClass("_acsActive")}),this._showWait(),this._trapKeyBoard(u,m)},s.renderSurvey=function(){this._removeWait(),this.$head.addClass("acsVisible"),this.survey.ansLogoSrc=e.makeURI("$p_b_foresee.svg"),this.survey.meta.prologuetext=this._addTitleDescIds(this.survey.meta.prologuetext),this.survey.meta.epiloguetext=this._addTitleDescIds(this.survey.meta.epiloguetext);var t=this.modaltemplate(this.survey);this.$content.innerHTML=t,this.sv.bind(this.$content),this.positionModal(),this.$content.addClass("acsVisible"),c.onFeedbackShown.fire(this.$el),this.jrny&&this.jrny.addEventObj({name:"feedback_survey_shown",properties:{mid:[this.cfg.mid]}}),c.onModalCssRetrieved.subscribe(function(){document.getElementById("fsrModalFocus").focus()},!0,!0)},s._addTitleDescIds=function(e){var t=document.createElement("div");t.innerHTML=e;var i=t.childNodes[0],s=t.childNodes[1],n="";if(t.childNodes.length>2)for(t.removeChild(t.childNodes[0]),(s=document.createElement("div")).setAttribute("style","padding: 0; margin: 0;");t.hasChildNodes();){var r=t.firstChild;t.removeChild(r),s.appendChild(r)}return i.setAttribute("id","acsFeedbackDialogTitle"),n=i.outerHTML,s&&(s.setAttribute("id","acsFeedbackDialogDesc"),n+=s.outerHTML),n},s.positionModal=function(){var e,i=t.getSize(window),s=this.$content.offsetHeight||this.prevOffsetHeight;i.h>s&&(e=Math.max(0,(i.h-s-50)/2)+"px"),this.head.style.marginTop=e,l&&l.FBALTOVERFLOW&&this.$el.css({"overflow-y":"scroll",display:"block"})},s.show=function(){this.positionModal(),this.$el.css({display:"block"}),c.onFeedbackShown.fire(this.$el)},s.focusOnBadge=function(){var e=this.instcfg.badge&&this.instcfg.badge.$el;e&&e.focus()},s._trapKeyBoard=function(e,i){i=i||e,t.Bind(document.body,"feedbackModal:focus",function(s){var n=(s=s||window.event).target||s.srcElement,r=document.getElementById("acsMainInvite")||document.getElementById("fsrInvite");r&&t.DOMContains(r,n)||t.DOMContains(e,n)||i&&(s.stopPropagation(),i.focus())},!1)},s._getSurveyData=function(){var e=this;if(this.sv.isExpired())this.networkError.fire({type:"expired"});else{var t={mid:this.sv.cfg.mid,cachebust:(new Date).getTime()};this.sv.cfg.version&&(t.version=this.sv.cfg.version),this._surveyTimer=setTimeout(function(){e.networkError.fire({type:"timedout"})},1e4),this.ajax.send({url:this.sv.cfg.datauri,data:t,method:"GET",skipEncode:!1,success:function(t){e.networkError.didFire||(clearTimeout(e._surveyTimer),e.sv.SurveyData.fire(t,function(t){e.survey=t,e.renderSurvey()}))},failure:function(){e.networkError.didFire||e.networkError.fire({type:"getdata_failed"})}})}},s._postSurveyData=function(t){var i=this;if(this.cfg.preview)e.nextTick(function(){if(t)return t()});else{var s=JSON.parse(this.sv._serialize());this.jrny&&this.jrny.config&&this.jrny.config.disable_cpps&&this.jrny.config.disable_cpps.indexOf("url")>-1&&(s.url=""),e.isArray(s.responses)&&s.responses.push({questionId:"deployment_type",answerText:"BADGE"}),c.onFeedbackSubmitted.fire(e.ext({rating:this.sv._getScore()},s)),this._surveyTimer=setTimeout(function(){i.networkError.fire({type:"timedout"})},1e4),this.ajax.send({method:"POST",url:this.cfg.posturi,data:s,contentType:"application/json",success:function(){if(clearTimeout(i._surveyTimer),t)return t()},failure:function(){clearTimeout(i._surveyTimer),sessionStorage.setItem("acsFeedbackSubmitted","true"),i.networkError.fire({type:"postdata_failed"})}})}},i}(),u=null,p=null,m=t.now(),v={setup:function(i,s,n,r){e.globalConfig.products.record?window._fsRequire([e.makeURI("$fs.record.js")],function(n){p||(p=t.getGeneralStorage(i));var o={id:e.globalConfig.customerId||t.getRootDomain()||"feedback_customerId"};u=n.getInstance(i,window,p,o,s),r(u)}):e.nextTick(r)},startProcessing:function(e,i,s){v.startTransmitting(e,i,s,function(e){e&&e.recorder&&e.recorder.processImmediately(Math.max(2e4-(t.now()-m),0))})},dispose:function(){u&&(u.dispose(),u=null)},startTransmitting:function(e,i,s,n){if(m=t.now(),!0===s.replay)if(u){if(u.beginTransmitting(),n)return n(u)}else v.setup(e,i,s,function(e){if(e.beginTransmitting(),n)return n(e)})}},b=function(){function i(e,i,s){this.height=600,this.width=400,this.survey=e,this.cfg=i,this.cpps=e.cpps,this.SurveySubmitted=new t.FSEvent,this.br=s,this.jrny=i.jrny,this.networkError=t.FSEvent()}var n=i.prototype;return n._getCXRParams=function(){var t="";return!0===this.cfg.replay&&void 0!==u&&(t+="cxrid="+e.enc(u.getGlobalId())+"&cxrurl="+e.enc(e.globalConfig.recUrl)),t},n.show=function(){if(!this.winRef){var i,n=this.cfg.preview?null:JSON.stringify(this.cpps.all()),r=this,o=window,a=this.cfg.badge&&this.cfg.badge.btncfg&&this.cfg.badge.btncfg.mid?this.cfg.badge.btncfg.mid:this.cfg.mid,d={global:e.globalConfig,product:this.cfg.preview?null:function(t,i){for(var s=e.ext({},i),n=0;n<s.instances.length;n++)if(t===s.instances[n].mid){s.instances=[e.ext({},s.instances[n],!1)];var r=s.instances[0];delete r.badge,delete r.jrny,delete r.record,delete r.stg;break}return s}(a,e.getProductConfig("feedback"))},l=["&mid=",e.enc(a),"&_gwl_=",e.enc(e.home),"&_cv_=",e.enc(e.globalConfig.codeVer),"&_au_=",e.enc(e.globalConfig.analyticsUrl),"&_vt_=",e.enc(e.tagVersion),"&_issh_=",e.enc(e.isSelfHosted),"&_pa_=",e.enc(e.assetLocation),e.codeLocation?"&_cl_="+e.enc(e.codeLocation):""].join("");if(this.cfg.preview)i=e.makeURI(["$fs.feedbacksurvey.html?mid=",e.enc(this.survey.cfg.mid),"&t=",e.enc(this.cfg.template||"default"),"&datauri=",e.getParam("datauri"),"&ns=",e.enc("preview"),"&_gcfg_=",e.enc(s.compress(e.enc(JSON.stringify(d)))),l].join(""));else i=e.makeURI(["$fs.feedbacksurvey.html?","&t=",e.enc(this.cfg.template||"default"),"&fsUrl=",e.enc(o.location.href),"&uid=",e.enc(c.stg.uid),"&ns=",e.enc(e.globalConfig.siteKey),"&brain=",e.enc(e.globalConfig.brainUrl),l].join("")),!0===e.globalConfig.products.record&&(i+="&"+this._getCXRParams()),t.getBrainStorage(this.br,c.stg.uid,this.cfg.preview?"preview":e.globalConfig.siteKey).set("fscfg",{gcfg:e.enc(s.compress(e.enc(JSON.stringify(d)))),cid:e.enc(e.globalConfig.customerId),cpps:e.enc(s.compress(n))});this.br.isIE&&this.br.browser.actualVersion<=11&&("//"==i.substr(0,2)&&(i="https:"+i),"http"==i.substr(0,4)&&i.replace("http","https")),this.cfg.preview&&(o!==o.top||o.location.toString().indexOf("fscommand=feedbackpreview")>-1)?o.location.href=i:(this.winRef=o.open(i,"_system"),this._checkerFailsAllowed=20,this._checker=setInterval(function(){try{if(!0===r.winRef.closed)return clearInterval(r._checker);var e=""+r.winRef.location,t="fsSurveyComplete=";if(e.indexOf(t)>-1){clearInterval(r._checker);var i=s.decompress(decodeURIComponent(e.substr(e.indexOf(t)+t.length)));c.onFeedbackSubmitted.fire(JSON.parse(i)),r.SurveySubmitted.fire(JSON.parse(i))}}catch(n){if(r._checkerFailsAllowed>0)return void r._checkerFailsAllowed--;clearInterval(r._checker),r.SurveySubmitted.fire()}},500))}c.onFeedbackShown.fire(this.winRef)},i}(),g=function(){function s(e,i,s,n,r,o){this.cfg=e,this.br=i,this.cpps=s,this.errortemplate=n,this.modaltemplate=r,this.eptemplate=o,this.jrny=e.jrny,this.init(),this.SurveySubmitted=new t.FSEvent,this.NetworkError=new t.FSEvent}var n=s.prototype;return n.init=function(){var t=this;switch(this.cfg.surveytype){case"popup":this.survey=new i.Survey(this.cfg,this.cpps,this.br),this.chrome=new b(this.survey,this.cfg,this.br),this.chrome.SurveySubmitted.subscribe(function(){t.SurveySubmitted.fire(),c.onFeedbackClosed.fire()}),this.chrome.show();break;case"modal":e.isDefined(this.chrome)?(this.chrome.show(),c.onFeedbackShown.fire()):(this.survey=new i.Survey(this.cfg,this.cpps,this.br),this.chrome=new f(this.survey,this.br,this.cfg,this.errortemplate,this.modaltemplate,this.eptemplate),this.chrome.SurveySubmitted.subscribe(function(){t.SurveySubmitted.fire()}),this.chrome.networkError.subscribe(function(){t.NetworkError.fire()}));break;case"fullpage":e.isDefined(this.chrome)?(this.chrome.show(),c.onFeedbackShown.fire()):(this.survey=new i.Survey(this.cfg,this.cpps,this.br),this.chrome=new d(this.survey,this.br,this.cfg,this.errortemplate,this.modaltemplate,this.eptemplate),this.chrome.SurveySubmitted.subscribe(function(){t.SurveySubmitted.fire()}),this.chrome.networkError.subscribe(function(){t.NetworkError.fire()}));break;default:throw new Error("Unknown feedback surveytype: "+this.cfg.surveytype)}},n.show=function(){this.chrome.show()},n.remove=function(){this.chrome&&this.chrome.remove&&this.chrome.remove()},s}(),y={Current:null,getPopup:function(e){return!(t.getSize(window).w<=500)&&(!(!y.Current||y.Current.cfg.mid!=e)&&y.Current)},disposePopups:function(){y.Current&&y.Current.remove(),y.Current=null},removePopup:function(e){y.Current&&y.Current.cfg.mid==e&&(y.Current.remove(),y.Current=null)},initialize:function(e,t,i,s,n,r){y.disposePopups(),e.surveytype||void 0===e.popup||(e.surveytype=e.popup?"popup":"modal"),e.surveytype=y.computeSurveyType(e.surveytype);var o,a=y.getPopup(e.mid);return a&&!a.cfg.popup?a.show():(a=new g(e,t,i,s,n,r),y.Current=a,a.SurveySubmitted.subscribe((o=e,function(){y.SurveySubmitted.fire(o)})),a.NetworkError.subscribe(function(){y.NetworkError.fire()})),a},computeSurveyType:function(e){return"fullpage"!==e&&(c.browser.isMobile||t.getSize(window).w<=500)?"popup":e}};y.SurveySubmitted=new t.FSEvent,y.NetworkError=new t.FSEvent;var w,k,_,C,S=function(i){var s=window._acsURL||window.location.toString();function n(e){if(!Array.isArray(e))return!1;for(var i=0;i<e.length;i++)if(t.testAgainstSearch(e[i],s))return!0;return!1}return s=e.toLowerCase(s),(!i.whitelistActive||n(i.whitelistData))&&(!i.blacklistActive||!n(i.blacklistData))},T=new t.FSEvent;e.API.expose("CPPS",{set:function(){var e;T.subscribe((e=arguments,function(){c.CPPS.set.apply(c.CPPS,e)}),!0,!0)},get:function(e,t){var i;t=t||console.log||function(){},T.subscribe((i=[arguments],function(){t(c.CPPS.get.apply(c.CPPS,i[0]))}),!0,!0)},all:function(e){e=e||console.table||console.log||function(){},T.subscribe(function(){e(c.CPPS.all.apply(c.CPPS))},!0,!0)}}),e.API.expose("clearStateFeedback",function(){T.subscribe(function(){c.stg.reset()},!0,!0)});var $=function(i){var s=!1,n=!1,r=e.getProductConfig("feedback").instances;clearTimeout(w),clearTimeout(k),t._preventUnloadFor(500);for(var o=0;o<r.length;o++)if(r[o].mid==i){s=r[o];break}if(s&&s.disabled)return"This feedback has been disabled.";if(s.topics&&s.topics.length)for(var a=0;a<s.topics.length;a++)if(S(s.topics[a])){n=!0;break}if(!s)return"Error: MID provided is not valid";if(!n&&0!==s.topics.length)return"Error: Either this measure is disabled or there are no active topics";if((n||0===s.topics.length)&&!s.disabled){if(s.surveytype||void 0===s.popup||(s.surveytype=s.popup?"popup":"modal"),s.template||(s.template="default"),"popup"==y.computeSurveyType(s.surveytype))return void y.initialize(s,c.browser,c.CPPS);var d={},l=function(i,s,n,r){var o=e.makeURI("$templates/feedback/"+(i||"default")+"/"+s+".html");new t.TemplateFetcher({success:function(e){return n&&n.resolve(),r(e)},failure:function(){n&&n.error()}}).get(o)},h=new t.Async(!0,function(){console.warn("api: Fetched the templates "),void 0===c.browser&&(c.browser=new t.Browser),void 0===c.CPPS&&(c.CPPS=new t.CPPS(t.getGeneralStorage(c.browser))),y.initialize(s,c.browser,c.CPPS,d.emTemplate,d.svContentsTemplate,d.epTemplate)},function(){console.warn("api: Failed fetching the templates ")});h.enqueue(function(i){t.loadCSS(e.makeURI("$templates/feedback/"+(this.template||"default")+"/main.css"),function(){c.onModalCssRetrieved.fire(),i&&i.resolve()},function(){i&&i.error()})}),h.enqueue(function(e){l(s.template,"epilogue",e,function(e){d.epTemplate=e})}),h.enqueue(function(e){l(s.template,"surveycontents",e,function(e){d.svContentsTemplate=e})}),h.enqueue(function(e){l(s.template,"serviceunavailable",e,function(e){d.emTemplate=e})})}};e.API.expose("launchFeedback",$),e.API.expose("launchACSFeedback",$),e.API.expose("resetFeedback",function(){clearTimeout(k),w&&(clearTimeout(w),w=null),w=setTimeout(function(){for(w=null;C.length>0;){var i=C.pop();i.badge&&i.badge.dispose()}t.Unbind("feedback:*"),t.Unbind("feedbackModal:*"),t.pageNavEvent.unsubscribe(c.pageResetFn),v.dispose(),y.disposePopups(),k=e.nextTick(function(){_()})},200)}),e.API.expose("onFeedbackSubmitted",c.onFeedbackSubmitted),e.API.expose("onFeedbackShown",c.onFeedbackShown),e.API.expose("onFeedbackClosed",c.onFeedbackClosed);var E=function(){function e(e,t){this.br=e,this.cfg=t}return e.prototype.platformOK=function(){var e=this.cfg,t=this.br;return!(e.browser_cutoff[t.browser.name]&&t.browser.actualVersion<e.browser_cutoff[t.browser.name])&&!(e.platform_cutoff[t.os.name]&&t.os.version<e.platform_cutoff[t.os.name])},e}();var F=function(){function i(e,t,i){this.template=i,this.br=e,this.cpps=t,this.emTemplate=null,this.css=null,this.typeTemplate=null,this.svContentsTemplate=null,this.epTemplate=null}var s=i.prototype;return s.getCss=function(i){t.loadCSS(e.makeURI("$templates/feedback/"+(this.template||"default")+"/main.css"),function(e){e?(i&&i.resolve(),c.onModalCssRetrieved.fire()):i&&i.error()},null,this.br)},s.getTemplate=function(i,s,n){var r=e.makeURI("$templates/feedback/"+(this.template||"default")+"/"+i+".html");new t.TemplateFetcher({success:function(e){if(s&&s.resolve(),n)return n(e)},failure:function(){s&&s.error()}}).get(r)},s.grabTemplates=function(e){var i=this;this.queue=new t.Async(!0,function(){if(e)return e({typeTemplate:i.typeTemplate,emTemplate:i.emTemplate,epTemplate:i.epTemplate,svContentsTemplate:i.svContentsTemplate})},function(){}),this.queue.enqueue(function(e){i.getCss(e)}),this.queue.enqueue(function(e){i.getTemplate("badge",e,function(e){i.typeTemplate=e})}),this.queue.enqueue(function(e){i.getTemplate("serviceunavailable",e,function(e){i.emTemplate=e})}),this.queue.enqueue(function(e){i.getTemplate("epilogue",e,function(e){i.epTemplate=e})}),this.queue.enqueue(function(e){i.getTemplate("surveycontents",e,function(e){i.svContentsTemplate=e})})},i}(),j=function(e,i,s){var n=this;this.br=e,this.cpps=i,this.templateHolder={},this.loadSuccess=new t.FSEvent,this.loadFailure=new t.FSEvent;var r=new t.Async(!0,function(){n.loadSuccess.fire(n.templateHolder)},function(){n.loadFailure.fire()});s.forEach(function(e){r.enqueue(function(t){new F(n.br,n.cpps,e).grabTemplates(function(i){i?(n.templateHolder[e]=i,t.resolve()):t.error()})})})},x=function(){function i(i){this.br=i,this.mid=t.getHashParm("mid"),this.previewmode=e.toLowerCase(t.getHashParm("previewmode")),this.datauri=t.getHashParm("datauri"),this.template=t.getHashParm("template")||"default",this.surveytype=t.getHashParm("surveytype")?t.getHashParm("surveytype"):"modal",this.tempHolder={}}return i.prototype.show=function(){var e=this;if(!(this.mid&&this.previewmode&&this.datauri))throw new Error("You need mid, previewmode, and datauri.");var t=new j(this.br,{},[this.template]);t.loadSuccess.subscribe(function(t){e.tempHolder=t[e.template],y.initialize({mid:e.mid,datauri:e.datauri,posturi:"",reporturi:"",surveytype:e.surveytype,autowhitelist:!0,preview:!0,template:e.template,replay:!1},e.br,null,e.tempHolder.emTemplate,e.tempHolder.svContentsTemplate,e.tempHolder.epTemplate)}),t.loadFailure.subscribe(function(){})},i}(),P=function(){function i(i,s,n,r,o,a){this.cfg=i,this.cpps=n,this.jrny=i.jrny;var c,d="acsFeedbackResultsCounter",l=i.previewMode?i.previewMode.toLowerCase():"";(this.btncfg=i,this.badgeClicked=new t.FSEvent,this.surveyTriggered=new t.FSEvent,this.br=s,i.devices&&i.devices.overridesEnabled)&&(c=s.isTablet||"tablet"===l?i.devices.tablet:s.isMobile||"mobile"===l?i.devices.mobile:i.devices.desktop,e.ext(this.cfg,c),this.cfg.icon.lastIndexOf(".png")>-1&&(this.btncfg.icon=this.cfg.icon.replace(".png",".svg")));this.animationMove=4,i.counter&&(this.counter=0,sessionStorage.getItem(d)&&(this.counter=Math.round(parseFloat(sessionStorage.getItem(d))),this.counter=isNaN(this.counter)?0:this.counter),this.btncfg.counter=this.counter,this.btncfg.counterLocale=i.counter.toLocaleString()),this.btncfg.fbsize=this.cfg.fbsize||"medium",this.btncfg.btnClass="_acs _acs"+i.fbtype+"--"+i.template+" _acsbadge--"+this.btncfg.fbsize+" _acs"+i.fblocation,this.btncfg.fbcolortext=this.btncfg.fbcolortext||"#fff",this.btnTemplate=r,this.emtemplate=o,this.enabled=!!a}var s=i.prototype;return s.setBtnTemplate=function(){var e=this,i={btncfg:this.btncfg},s=this.btnTemplate(i),n=this;n.badgeClicked.subscribe(function(){n.jrny&&n.jrny.addEventObj({name:"feedback_clicked"+(n.br.isMobile?"_mobile":""),properties:{mid:[n.cfg.mid]}}),n.surveyTriggered.fire({emtemplate:n.emtemplate})},!1,!0),this.$el=document.createElement("div"),this.$el.innerHTML=s,this.$el=o(this.$el.querySelectorAll("div._acs")[0]),this.enabled&&(t.Bind(this.$el,"feedback:click",function(){n._unhover(),n.badgeClicked.fire(n.cfg)}),t.Bind(this.$el,"feedback:keypress",function(e){var i=t.getKeyCode(e);"enter"!==i&&"spacebar"!==i||(n._unhover(),n.badgeClicked.fire(n.cfg))})),this.cfg.fbanimate&&(t.Bind(this.$el,"feedback:mouseenter",function(){n._hover()}),t.Bind(this.$el,"feedback:mouseleave",function(){n._unhover()})),this.btncfg.label.length||(this.$el.querySelector("._acsBadgeLabel").style.paddingLeft=0),document.body.appendChild(this.$el),l&&!l.FBALTPOSITION&&t.addClass(document.documentElement,"fsfb fsfb-relbody"),this.cfg.delay&&this.cfg.delay>0?setTimeout(function(){e.init()},this.cfg.delay):this.init()},s._hover=function(){this.cfg.fbanimate&&this.$el.addClass("_acsHover")},s._unhover=function(){this.cfg.fbanimate&&this.$el.removeClass("_acsHover")},s.init=function(e){var i=this.$el.$("._acsBadgeLabel"),s=this,n=t.getGeneralStorage(this.br);if(e=e||function(){},s.jrny&&!n.get("fbb")&&(n.set("fbb","s",864e5),s.jrny.addEventObj({name:"feedback_button_shown",properties:{mid:[s.cfg.mid]}})),this.$el.css({visibility:"hidden"}),i&&i.length>0){if(e){var r=this.$el;setTimeout(function(){s._unhover(),setTimeout(function(){r.addClass("_acsAnimate"),e()},250)},250),"vertical"==this.cfg.fbdirection&&(this.cfg.fblocation.indexOf("right")>-1?this.$el.addClass("_acsVertical_right"):this.$el.addClass("_acsVertical_left")),this.cfg.fbfixed&&this.$el.addClass("_acsFixed")}"none"===this.cfg.fbtype?this.$el.css({display:"none"}):this.$el.css({visibility:"visible"}),s.br.isMobile&&this.$el.setAttribute("role","link")}},s.remove=function(){this.enabled=!1,this.$el&&this.$el.parentNode&&this.$el.parentNode.removeChild(this.$el)},s.dispose=function(){this.remove(),this.disposed=!0},i}();function I(e,t){e=e||this.cfg,t=t||this.br;var i=e.previewMode?e.previewMode.toLowerCase():"",s=e.fbtype;return e&&t?(e.devices&&e.devices.overridesEnabled&&(s=t.isTablet||"tablet"===i?e.devices.tablet.fbtype||e.fbtype:t.isMobile||"mobile"===i?e.devices.mobile.fbtype||e.fbtype:e.devices.desktop.fbtype||e.fbtype),s):s}var M,O,B=function(){function e(e,t,i){this.cfg=e,this.br=t,this.cpps=i,this.cfg.template=void 0!==this.cfg.template?this.cfg.template:"default",this.cfg.surveytype=void 0!==this.cfg.surveytype?this.cfg.surveytype:"modal",this.cfg.fbcolor=void 0!==this.cfg.fbcolor?this.cfg.fbcolor:"#F24554",this.cfg.fbcolortext=void 0!==this.cfg.fbcolortext?this.cfg.fbcolortext:"#FFFFFF",this.cfg.replay=void 0!==this.cfg.replay&&this.cfg.replay}return e.prototype.renderBadge=function(){var e=this,t=new j(this.br,this.cpps,[this.cfg.template]);t.loadSuccess.subscribe(function(t){var i=t[e.cfg.template];e.cfg.badge=new P(e.cfg,e.br,e.cpps,i.typeTemplate,i.emTemplate,!1),e.cfg.badge.setBtnTemplate()}),t.loadFailure.subscribe(function(){})},e}();t.registerProduct("feedback"),M=e.getProductConfig("feedback"),O=e.ext({browser_cutoff:{Edge:1,IE:11,IEMobile:10,Safari:5.2,Firefox:30,Chrome:30,Opera:1e3},platform_cutoff:{Android:5,Winphone:7.4,iPod:9,iPhone:9,iPad:9}},M),e.ext(M,O);var N=[],H=window.location;function A(){var i=e.getProductConfig("feedback"),s=!!t.getHashParm("previewmode"),n=!!e.getParam("previewbadgemode"),r=i.instances,o=[],a=!1;if(H=JSON.parse(JSON.stringify(window.location)),r||s||n){var d=new t.Browser;d.ready.subscribe(function(){var l=t.getGeneralStorage(d);l.ready.subscribe(function(){if(s){new x(d).show()}else{var h=new E(d,i),f=new t.CPPS(l),u=e.globalConfig.adobeRsid;t.initBehavioralData(e.globalConfig.customerId||t.getRootDomain()||"feedback_customerId",l,d,f),f.set("code",e.globalConfig.codeVer),f.set("tz",-(new Date).getTimezoneOffset()),f.set("env",e.isProduction?"prd":"stg"),t.INT.GA.has()&&t.INT.GA.uid(function(e){e&&f.set("GA_UID",e)});var m=function(e){f.set(e.name,e.value)};if(t.INT.OM.uid(u,m),t.INT.OM.mcid(u,m),t.INT.OM.beacon(function(e){f.set("OMTR_BEACON",e)}),n){var b=JSON.parse(e.getParam("cfg")),g=e.getQueryString("previewbadgemode")||"desktop";b.mid&&(b.previewMode=g,new B(b,d,f).renderBadge())}else if(c.CPPS=f,c.browser=d,c.stg=l,h.platformOK()){T.fire(),c.pageResetFn=function(){var t,i=window.location,s=function(e){var t=(e=e||"").split("#");return t.length>2?t[0]+t[1]:e.replace(/#/gi,"")};s(H.hash)==s(i.hash)&&H.pathname==i.pathname||window.fsReady(function(){clearTimeout(t),t=setTimeout(function(){var t=e.API.retrieveFromAPI("resetFeedback");e.isFunction(t)&&t()},1e3)})},t.pageNavEvent.subscribe(c.pageResetFn,!1,!1);for(var w=0;w<r.length;w++){var k=r[w],_=!1;if(S(k)&&k.topics&&k.topics.length)for(var C=0;C<k.topics.length;C++)if(S(k.topics[C])){_=!0;break}if(!0===e.globalConfig.products.record&&!0===k.replay&&!1===k.disabled&&(a=!0,"y"!=l.get("fbr")&&l.set("fbr","y")),(_||k.topics&&0===k.topics.length)&&!k.disabled&&window==window.top){var $=!1;k.template||(k.template="default");for(var F=0;F<o.length;F++)o[F]===k.template&&($=!0);$||o.push(k.template),k.jrny=new t.Journey({customerId:e.globalConfig.customerId||t.getRootDomain()||"feedback_customerId",appId:t.APPID.FEEDBACK,stg:l,browser:d,throttleDuration:1e3,useSessionId:!0,usePopupId:!1}),N.push(k)}}if(N.length>0){var M,O=o.length>0?o:["default"];new j(d,f,O).loadSuccess.subscribe(function(e){for(var t=0;t<N.length;t++){var i=N[t];if("badge"===I(i,d)){0==t&&d.isIE&&((M=document.createElement("div")).className="acs-feedback__forcefont",document.body.appendChild(M));var s=e[i.template];i.badge=new P(i,d,f,s.typeTemplate,s.emTemplate,!0),i.badge.setBtnTemplate(),i.badge.surveyTriggered.subscribe(n(i,s),!1,!1)}}function n(e,t){return function(){!0===e.replay&&a&&v.startTransmitting(d,f,e),e.jrny.initPopupId(),y.initialize(e,d,f,t.emTemplate,t.svContentsTemplate,t.epTemplate)}}y.SurveySubmitted.subscribe(function(e){var t,i;if(e&&e.mid)for(a&&v.startProcessing(d,f,e),t=0;t<N.length;t++)N[t].badge&&N[t].mid===e.mid&&N[t].badge.remove();else for(i=0;i<N.length;i++)N[i].badge&&N[i].badge.remove()})},!0,!0)}a&&v.setup(d,f,N[0],function(e){for(var t=0;t<N.length;t++)N[t].stg=p,N[t].record=e})}}},!0,!0)},!0,!0)}}return n.startup=function(){if(function(){var t=e.getProductConfig("fbmods")||{},i=e.toLowerCase(window.location.href.toString());if((t.noPositionRelativeBody||i.indexOf("buildabear.c")>-1||i.indexOf("bab-dev-store.sparkred.")>-1||i.indexOf("humana.c")>-1||i.indexOf(".dteenergy.c")>-1||i.indexOf(".mcdonalds.")>-1)&&(l.FBALTPOSITION=!0),(t.overflowScroll||i.indexOf(".peco.c")>-1||i.indexOf(".bge.com")>-1||i.indexOf(".comed.com")>-1)&&(l.FBALTOVERFLOW=!0),(t.skipIFrames||i.indexOf("argos.co")>-1)&&window!==window.top)return!1;if(t.temporaryCssHack&&!h){h=!0;var s=document.createElement("style");s.innerHTML="\n/* ForSee Feedback CSS Styles */\n"+t.temporaryCssHack,document.head.append(s)}return!0}()){if(e.fsCmd("feedbackreport")||e.supportsDomStorage&&"true"==sessionStorage.getItem("fsFeedbackLoaded"))return e.supportsDomStorage&&sessionStorage.setItem("fsFeedbackLoaded","true"),void window._fsRequire([e.makeURI("$fs.feedbackreport.js")],function(){});_=A,C=N,e.domReady(A)}},n});
