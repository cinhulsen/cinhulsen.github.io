/***************************************
 * @preserve
 * Copyright (c) 2019 Verint Systems, Inc. All rights reserved.
 * ForeSee Web SDK: Feedback Standalone Survey
 * Version: 19.11.2
 * Built: November 07, 2019, 12:47:06 CST
 ***************************************/
_fsDefine([_fsNormalizeUrl("$fs.compress.js"),"fs",_fsNormalizeUrl("$fs.utils.js"),_fsNormalizeUrl("$fs.survey.js"),"exports"],function(e,t,i,s,r){var n={remove:function(){this.parentNode&&this.parentNode.removeChild(this)},hasClass:function(e){return this.className.indexOf(e)>-1},addClass:function(e){this.hasClass(e)||(this.className+=" "+e)},removeClass:function(e){this.className=(this.className||"").replace(e,""),this.className=this.className.replace(/[ ]+$/g,"")},$:function(e){return this.querySelectorAll(e)},css:function(e){for(var i in e)t.hasProp(e,i)&&(this.style[i]=e[i])}},a=function(e){if("string"==typeof e&&-1==e.indexOf("<"))return document.querySelectorAll(e);if("string"==typeof e){var i=document.createElement("div");i.innerHTML=e,e=i.firstChild}for(var s in n)t.hasProp(n,s)&&(e[s]=n[s]);return e},o=function(){function e(){this.$el=a('<img src="'+window._fsNormalizeUrl("$loader.gif")+'" class="acs-loader">'),this.$el.setAttribute("alt","loading survey"),this.$el.setAttribute("tabindex","-1"),this.$el.setAttribute("role","alert"),this.$el.setAttribute("aria-busy","true"),this.moveOffScreen()}var t=e.prototype;return t.center=function(){var e=i.getSize(window),t=i.getScroll(window),s=this.$el.offsetWidth,r=this.$el.offsetHeight;this.$el.css({left:(e.w-s)/2+"px",top:(e.h-r)/2+t.y+"px",display:"block",position:"absolute"})},t.moveOffScreen=function(){this.$el.css({left:"-999px",top:"-999px",display:"none"})},t.remove=function(){this.$el&&this.$el.parentNode&&this.$el.parentNode.removeChild(this.$el)},e}(),c=function(){function e(e){this.ns=e,this.config=t.globalConfig}var i=e.prototype;return i._isCPPEnabled=function(e){return!this.config.disable_cpps||this.config.disable_cpps.indexOf(e)<0},i.set=function(e,i){if(this._isCPPEnabled(e)&&t.supportsDomStorage){var s=JSON.parse(localStorage.getItem(this.ns)||"{}");s[e]=i,localStorage.setItem(this.ns,JSON.stringify(s))}},i.get=function(e){return JSON.parse(localStorage.getItem(this.ns)||"{}")[e]},i.all=function(){return JSON.parse(localStorage.getItem(this.ns)||"{}")},e}(),d={cxrid:t.getParam("cxrid"),cxrurl:t.getParam("cxrurl"),processImmediate:function(){d.cxrid&&d.cxrurl&&(new i.AjaxTransport).send({method:"GET",url:d.cxrurl+"process/"+t.enc(d.cxrid),failure:function(){},success:function(){}})}},l=function(){function r(r,n,d,l,u,f,p){var h,m=this,v=this;if(this.isStandalone=p,this.cpps=new c(f),this.cpps.config=r.global,this.networkError=new i.FSEvent,u)for(var g in!t.isObject(u)&&u.length>2&&(u=JSON.parse(e.decompress(u))),u)this.cpps.set(g,u[g]);if(this.br=n,this.didSubmit=!1,document.body.setAttribute("aria-live","assertive"),this.loader=new o,document.body.appendChild(this.loader.$el),r&&r.instances&&r.instances.length)for(var b=0;b<r.instances.length;b++)if(r.instances[b].mid==l){h=this.cfg=r.instances[b];break}if(void 0===h&&(r.preview||"preview"===f)){var y=t.getParam("datauri"),w=t.getParam("template")||"default";h=this.cfg={mid:l,datauri:y,posturi:"",reporturi:"",surveytype:"popup",autowhitelist:!0,preview:!0,template:w,replay:!1}}if(h){var _=n.isIE&&10==n.browser.actualVersion?" acsIE10":"";document.title=this.cfg.label,this.jrny=d,this.sv=new s.Survey(this.cfg,this.cpps,this.br),this.sv.cfg.privacyuri=this.sv.cfg.privacyuri?this.sv.cfg.privacyuri:"http://www.foresee.com/about-us/privacy-policy/",this.sv.cfg.privacytext=this.sv.cfg.privacytext?this.sv.cfg.privacytext:"Privacy policy",this.$content=a('<div id="acsMainContentDialog" class="acsMainContainerMobile--'+h.template+_+'" role="dialog" aria-labelledby="acsFeedbackDialogTitle" aria-describedby="acsFeedbackDialogDesc" aria-live="assertive"></div>'),this.networkError.subscribe(function(e){v.jrny&&(e&&e.type?v.jrny.addEventObj({name:"feedback_survey_"+e.type,properties:{mid:[v.cfg.mid]}}):v.jrny.addEventObj({name:"feedback_server_error",properties:{mid:[v.cfg.mid]}})),m.renderError(e.type)}),this.initQ=new i.Async(!0,function(){m._getTemplatesAndRender()},function(){window.close()}),this.initQ.enqueue(function(e){m._getCSS(e)}),this.initQ.enqueue(function(e){m._getTemplate("serviceunavailable",e,function(e){m.errTemplate=e})})}i.Bind(window,"unload",function(){!v.didSubmit&&v.jrny&&v.jrny.addEventObj({name:"feedback_abandoned",properties:{mid:[v.cfg.mid]}})})}var n=r.prototype;return n._getTemplatesAndRender=function(){var e=this,t=new i.Async(!0,function(){e.renderSurvey()},function(){e.renderError()});t.enqueue(function(t){e._getSurveyData(function(i){e.survey=i,t.resolve()})}),t.enqueue(function(t){e._getTemplate("epilogue",t,function(t){e.epTemplate=t})}),t.enqueue(function(t){e._getTemplate("surveycontents",t,function(t){e.svContentsTemplate=t})})},n._getCSS=function(e){i.loadCSS(t.makeURI("$templates/feedback/"+(this.sv.cfg.template||"default")+"/main.css"),function(t){t?e.resolve():e.error()},null,this.br)},n._getTemplate=function(e,s,r){var n=this.cfg.template||"default",a=t.makeURI("$templates/feedback/"+n+"/"+e+".html");new i.TemplateFetcher({success:function(e){return s&&s.resolve(),r(e)},failure:function(){s&&s.error()}}).get(a)},n._showThankyou=function(){var e=this.epTemplate(this.survey);this.didSubmit=!0,this.$content.innerHTML=e;for(var s=this.$content.$("h1"),r=0;r<s.length;r++)a(s[r]).addClass("acs-feedback__heading acs-feedback__heading--h1");var n=this.$content.$(".acs-close-button")[0];0===(""+t.getParam("ok")).indexOf("false")?(n.style.display="none",this.$content.$(".acs-footer")[0].style.display="none"):this.cfg.preview||i.Bind(n,"click",function(){window.close()}),this.hideLoad()},n.showLoad=function(){document.body.setAttribute("aria-live","assertive"),document.getElementById("acsMainContentDialog").setAttribute("aria-live","assertive"),this.$content.css({display:"none"}),this.loader.center()},n.hideLoad=function(){this.loader.moveOffScreen(),i.hasClass(this.loader.$el,"acs-loader")&&this.loader.$el.setAttribute("aria-hidden",!0),this.$content.css({display:"block"}),setTimeout(function(){document.body.removeAttribute("aria-live"),document.getElementById("acsMainContentDialog").setAttribute("aria-live","off")},1e3)},n.renderSurvey=function(){var e=this,i=this,s=a("#acsPleaseWaitTable")[0];s.parentNode.removeChild(s),this.survey.meta.prologuetext=this._addTitleDescIds(this.survey.meta.prologuetext),this.survey.meta.epiloguetext=this._addTitleDescIds(this.survey.meta.epiloguetext),this.survey.ansLogoSrc=t.makeURI("$p_b_foresee.svg");var r=this.svContentsTemplate(this.survey);this.$content.innerHTML=r,window.document.body.appendChild(this.$content),this.sv.bind(this.$content),i.jrny&&i.jrny.addEventObj({name:"feedback_survey_shown",properties:{mid:[i.cfg.mid]}}),this.sv.SubmitClicked.subscribe(function(){e.showLoad(),i.jrny&&i.jrny.addEventObj({name:"feedback_submitted",properties:{mid:[i.cfg.mid]}}),e._postSurveyData(function(t){t?(e.cfg.preview||d.processImmediate(),e._showThankyou()):e.networkError.fire({type:"postdata_failed"}),window.surveycomplete=!0,"undefined"!=typeof fsrTracker&&fsrTracker.completeSurvey()})}),this.hideLoad()},n._addTitleDescIds=function(e){var t=document.createElement("div");t.innerHTML=e;var i=t.childNodes[0],s=t.childNodes[1],r="";if(t.childNodes.length>2)for(t.removeChild(t.childNodes[0]),(s=document.createElement("div")).setAttribute("style","padding: 0; margin: 0;");t.hasChildNodes();){var n=t.firstChild;t.removeChild(n),s.appendChild(n)}return i.setAttribute("id","acsFeedbackDialogTitle"),r=i.outerHTML,s&&(s.setAttribute("id","acsFeedbackDialogDesc"),r+=s.outerHTML),r},n.renderError=function(e){this.$content.innerHTML=this.errTemplate(this.sv);var t=this.$content.$(".acs-serviceunavailable__message")[0];if("expired"===e){for(;t.firstChild;)t.removeChild(t.firstChild);this.sv.cfg.fbexpiremessage?t.appendChild(a("<p>"+this.sv.cfg.fbexpiremessage+"</p>")):t.appendChild(a(this._unencodeHTML(this.sv.defaultCfg.expired)))}else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(a(this._unencodeHTML(this.sv.defaultCfg.unavailable)))}document.body.appendChild(this.$content);for(var s=this.$content.$("h3"),r=0;r<s.length;r++)a(s[r]).addClass("acs-feedback__heading acs-feedback__heading--h1");var n=this.$content.$(".acs-close-button")[0];this.cfg.preview||i.Bind(n,"click",function(){window.close()}),this.hideLoad();var o=a("#acsPleaseWaitTable")[0];o&&o.parentNode.removeChild(o)},n._unencodeHTML=function(e){return e.replace(/&lt;/gi,"<").replace(/&gt;/gi,">")},n._getSurveyData=function(e){var t=this;this.sv.isExpired()?this.networkError.fire({type:"expired"}):(this._surveyTimer=setTimeout(function(){t.networkError.fire({type:"timedout"})},1e4),new i.AjaxTransport({url:this.cfg.datauri,method:"GET",success:function(i){t.networkError.didFire||(clearTimeout(t._surveyTimer),t.sv.SurveyData.fire(i,function(t){if(e)return e(t)}))},failure:function(){clearTimeout(t._surveyTimer),t.networkError.fire({type:"getdata_failed"})}}).send({data:{mid:this.cfg.mid,cachebust:(new Date).getTime(),version:this.cfg.version}}))},n._postSurveyData=function(s){var r=this;if(this.cfg.preview)t.nextTick(function(){if(s)return s(!0)});else{this._surveyTimer=setTimeout(function(){r.networkError.fire({type:"timedout"})},1e4);var n=new i.AjaxTransport({url:this.sv.cfg.posturi,method:"POST",success:function(){if(clearTimeout(r._surveyTimer),s)return s(!0)},failure:function(){if(clearTimeout(r._surveyTimer),sessionStorage.setItem("acsFeedbackSubmitted","true"),s)return s(!1)}}),a=JSON.parse(this.sv._serialize());this.jrny&&this.jrny.config&&this.jrny.config.disable_cpps&&this.jrny.config.disable_cpps.indexOf("url")>-1&&(a.url=""),t.isArray(a.responses)&&a.responses.push({questionId:"deployment_type",answerText:this.isStandalone?"URL":"BADGE"});var o=e.compress(JSON.stringify(t.ext({rating:this.sv._getScore()},a)));this.isStandalone||(window.location.hash="fsSurveyComplete="+encodeURIComponent(o)),n.send({data:a,skipEncode:!0,contentType:"application/json"})}},r}();function u(){var s=new i.Browser;s.ready.subscribe(function(){"true"==document.getElementsByTagName("head")[0].getAttribute("data-isstandalone")?function(){var e=document.getElementsByTagName("head")[0],t={},i=[],r=e.getAttribute("data-url"),n=e.getAttribute("data-post-url"),a=e.getAttribute("data-version"),o=e.getAttribute("data-mid");t={cxReplay:!1,global:{},instances:[{autowhitelist:!0,datauri:r,delay:0,disabled:!0,fbanimate:!1,fbdirection:"horizontal",fbfixed:!1,fblocation:"middleright",fbtype:"badge",icon:"aspark100.png",label:"Feedback",mid:o,popup:!0,posturi:n,reporturi:"https://voc.foresee.com/client/feedback-admin/summary",saved:null,template:"default",topics:[{answerId:"",id:"1",order:1,topicText:"Default Topic",whitelistActive:!1}],version:a||1}]},decodeURIComponent(location.search).substring(1).split("&").forEach(function(e){var t=e.match(/^cpp\[([\w\d\s]*)\]=(.*)$/i);t&&(i[t[1]]=t[2])}),new l(t,s,null,o,i,"fs",!0)}():function(){var r={},n=null,a=null,o=!1,c=t.getParam("mid"),d=t.getParam("ns"),u=t.getParam("uid");if("preview"!==d){var f=t.getParam("brain"),p=i.getBrainStorage(s,u,d,f);p.setUpdateInterval(500),p.watchForChanges(["fscfg"],function(i,s,r){var a=JSON.parse(t.dec(e.decompress(t.dec(r.gcfg))));if(a.product&&a.product.instances){for(var o=!1,d=0;d<a.product.instances.length;d++){var l=a.product.instances[d];l.mid===c&&(o=!0)}if(!o)return}p.stopUpdateInterval(),n=JSON.parse(e.decompress(t.dec(r.cpps))),v(a,c,n,r.cid)},!1,!0)}else{var h=t.getParam("_gcfg_"),m=JSON.parse(t.dec(e.decompress(t.dec(h))));v(m,c,null,null)}function v(e,n,c,f){for(var p in e.product&&e.product.instances,(r=e.product||{}).global=e.global,r.global)t.globalConfig[p]=r.global[p];if("preview"!==d){var h=i.APPID.FEEDBACK;(a=new i.Journey({customerId:f,appId:h,stg:i.getBrainStorage(s,u,t.globalConfig.siteKey),browser:s,useSessionId:!1,usePopupId:!0})).config=e.global}return new l(r,s,a,n,c,d,o)}}()},!0,!0)}return r.startup=function(){t.winReady(u)},r});
